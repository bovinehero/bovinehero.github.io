---
author: bhero
topic: htb
---
Walkthrough for Popcorn : 10.10.10.6

## Enumeration

First we assign the ip addresses to a local variables:
 
``` bash
POPCORN=10.10.10.6
ATTACK=10.10.14.34
```
 
First we run the nmap scan (avoiding the ping) to identify the running services:
 
``` bash
nmap $POPCORN -Pn
```

This gives me the following output

```
Nmap scan report for 10.10.10.6
Host is up (0.046s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
```

Immediatley this looks like a Linux webserver, I kick up the gas to a more aggressive and focused scan:

``` bash
sudo nmap -sV --script=http-enum $POPCORN -Pn -p 80
```

and get the following:

```
Nmap scan report for 10.10.10.6
Host is up (0.042s latency).

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA)
|_  2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA)
80/tcp open  http    Apache httpd 2.2.12 ((Ubuntu))
|_http-server-header: Apache/2.2.12 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 2.6.17 - 2.6.36 (95%), Linux 2.6.32 (95%), Linux 2.6.35 (95%), Linux 2.4.20 (Red Hat 7.2) (95%), Linux 2.6.17 (95%), Linux 2.6.30 (95%), AVM FRITZ!Box FON WLAN 7240 WAP (94%), Canon imageRUNNER ADVANCE C3320i or C3325 copier (94%), Android 2.3.5 (Linux 2.6) (94%), Epson WF-2660 printer (94%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   39.30 ms 10.10.14.1
2   39.38 ms 10.10.10.6
```

Two open ports don't seem like a lot, but one of them is HTTP. Time for some analysis

## Triage

Immediatley I'm reluctant to look at the SSH service as it's behind authentication. I'll park that for later and look at the web app.

At this point most folks break out dirbuster or go buster, but we'll crack on with nmap.
I set a fast time scan with 20 parallel channels to run the http-enum directories and files against Popcorn on port 80

``` bash
sudo nmap -T5 --max-parallelism=20 --script=http-enum $POPCORN -Pn -p 80
```
 
within a few seconds I get the following:

```
Nmap scan report for 10.10.10.6
Host is up (0.045s latency).

PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|   /test/: Test page
|   /test.php: Test page
|   /test/logon.html: Jetty
|_  /icons/: Potentially interesting folder w/ directory listing
```

This uses a default wordlist which is useful for general analysis, but we want to dig deeper. We want to use a directory wordlist from dirbuster called __directory-list-2.3-medium.txt__.

Nmap's http-enum script uses the resources of the nikto web scanner to perform its enumeration, and while we could start a scan with dirbuster or gobuster, lets explore using nikto for the scan: 

``` bash
sudo nikto -h $POPCORN -mutate 6 -mutate-options directory-list-2.3-medium.txt
```

The mutate option is on the depricate hit-list for this tool, as an alternate we can specify the attack vector via a plugin:

``` bash
sudo nikto -h $POPCORN -Plugins "@@DEFAULT;dictionary(dictionary:/usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt)"
```

Unlike some nmap scripts, nikto is non invasive. The suggested weaknesses are the result of a light probing and are not always accurate, any findings here will need a manual follow up.

Soon we begin to see a return:

```
---------------------------------------------------------------------------
+ Target IP:          10.10.10.6
+ Target Hostname:    10.10.10.6
+ Target Port:        80
+ Start Time:         2018-02-11 21:19:24 (GMT0)
---------------------------------------------------------------------------
+ Server: Apache/2.2.12 (Ubuntu)
+ Server may leak inodes via ETags, header found with file /, inode: 43621, size: 177, mtime: Fri Mar 17 17:07:05 2017
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Uncommon header 'tcn' found, with contents: choice
+ Found file /index
+ Retrieved x-powered-by header: PHP/5.2.10-2ubuntu6.10
+ Found file /test
+ Found file /torrent
+ Found file /rename
```

as there are 220,000+ urls to check we'll crack on with the manual analysis in a different terminal.

/torrent and /rename are both interesting finds, lets cURL them:

starting with rename we get a redirect, so I follow it:

``` bash
curl -kiL $POPCORN/rename
```

to get:

```
HTTP/1.1 301 Moved Permanently
Date: Sat, 11 Feb 2018 21:29:13 GMT
Server: Apache/2.2.12 (Ubuntu)
Location: http://10.10.10.6/rename/
Vary: Accept-Encoding
Content-Length: 309
Content-Type: text/html; charset=iso-8859-1

HTTP/1.1 200 OK
Date: Sat, 11 Feb 2018 21:29:13 GMT
Server: Apache/2.2.12 (Ubuntu)
X-Powered-By: PHP/5.2.10-2ubuntu6.10
Vary: Accept-Encoding
Content-Length: 95
Content-Type: text/html

Renamer API Syntax: index.php?filename=old_file_path_an_name&newfilename=new_file_path_and_name
```

Interesting, a couple of variables that might allow us to do some file enumeration. I park this just now as I wonder if I can use it to read configs specified in the php.info() details from the /test URL.

On to torrent, which also bounces me through a redirect but takes me to a full on webapp:

``` bash
curl -kiL $POPCORN/torrent
```

Just the headers this time: 

``` bash
curl -kIL $POPCORN/torrent
```

```
HTTP/1.1 301 Moved Permanently
Date: Sat, 11 Feb 2018 21:40:47 GMT
Server: Apache/2.2.12 (Ubuntu)
Location: http://10.10.10.6/torrent/
Vary: Accept-Encoding
Content-Type: text/html; charset=iso-8859-1

HTTP/1.1 200 OK
Date: Sat, 11 Feb 2018 21:40:47 GMT
Server: Apache/2.2.12 (Ubuntu)
X-Powered-By: PHP/5.2.10-2ubuntu6.10
Set-Cookie: PHPSESSID=b0a2662beb823b3bc800b2b3723549b0; path=/
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: private
Pragma: no-cache
Vary: Accept-Encoding
Content-Type: text/html
```

At this point we need to get the browser involved, spinning up FireFox I go to http://10.10.10.6/torrent/


## Exploit
 
## Priv Escalation

## Bonus